;/*FB_PKG_DELIM*/

__d("LSRemoveBlindedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.ftr(b.db.table(308).fetch(),function(b){return b.configId===a[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSRemoveUsedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(a){return b.fe(b.ftr(b.db.table(309).fetch(),function(a){return b.i64.le(a.redeemLimit,b.i64.cast([0,0]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return d[0]=c.i64.of_float(Date.now()),d[1]=c.createArray(),c.ct(c.ftr(c.db.table(307).fetch(),function(b){return b.projectName===a[0]})).then(function(a){return d[2]=a})},function(b){return c.fe(c.ftr(c.db.table(307).fetch(),function(b){return b.projectName===a[0]}),function(a){a=a.item;return d[7]=a.configId,c.i64.gt(d[0],a.expirationTimestampMs)?c.fe(c.db.table(307).fetch([[[d[7]]]]),function(a){return a["delete"]()}):c.resolve(d[8]=(d[1].push(d[7]),d[1]))})},function(a){return c.sp(b("LSRemoveUsedTokens"))},function(a){return d[3]=c.i64.cast([0,0]),d[4]=c.i64.of_int32(d[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(a){return d[7]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[1],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.ct(c.ftr(c.db.table(309).fetch(),function(a){return a.configId===d[8]})).then(function(a){return d[10]=a})},function(a){return d[3]=c.i64.add(d[10],d[3]),c.sp(b("LSRemoveBlindedTokens"),d[8])}])}):c.resolve()},function(a){return c.i64.gt(d[2],c.i64.cast([0,0]))?(d[7]=c.i64.of_int32(d[1].length),d[5]=c.i64.ge(d[7],c.i64.cast([0,1]))):d[5]=f,d[5]!==f?(d[5]?(c.i64.gt(d[3],c.i64.cast([0,0]))?d[8]=c.i64.cast([0,3]):d[8]=c.i64.cast([0,2]),d[7]=d[8]):d[7]=c.i64.cast([0,1]),d[6]=d[7]):d[6]=c.i64.cast([0,0]),a=[d[6],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSIssueNextSync",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(b){return c.ct(c.ftr(c.db.table(310).fetch(),function(b){return b.projectName===a[1]})).then(function(a){return d[0]=a})},function(e){return c.i64.gt(d[0],c.i64.cast([0,0]))&&a[3]===!0?c.resolve(0):c.seq([function(b){return c.fe(c.ftr(c.db.table(310).fetch(),function(b){return b.projectName===a[1]}),function(a){return a["delete"]()})},function(e){return c.i64.gt(a[2],c.i64.cast([0,0]))?(d[3]=c.i64.of_float(Date.now()),d[1]=c.i64.add(d[3],a[2])):d[1]=c.i64.cast([0,0]),c.sp(b("LSIssueNewTaskAndGetTaskID"),["acs_sync","_",a[1]].join(""),c.i64.cast([0,362]),"",f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,d[1],c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.db.table(310).add({taskId:d[2],projectName:a[1],maxClientTokenPoolSize:a[0]})}])}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("getLSVoprfInstance",["asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("LSVoprfWasm").__setRef("getLSVoprfInstance"),i=null;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(i==null){var a=(yield h.load());a=(yield a());var b=a.createCurveRistretto(),c=a.createVoprfExpTwohashdh(b);i={voprfInfo:{curvePtr:b,voprfPtr:c},voprfWasm:a}}return i});return j.apply(this,arguments)}g["default"]=a}),98);
__d("LSVoprfBlind.nop",["asyncToGeneratorRuntime","getLSVoprfInstance"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){a=(yield c("getLSVoprfInstance")());b=a.voprfInfo;a=a.voprfWasm;a=a.blind(b,new Uint8Array(d));return[a.blindedElement.buffer,a.blindingFactor.buffer]});function d(b,c,d){return a.apply(this,arguments)}return d}();g["default"]=a}),98);
__d("LSVoprfCreateNonce.nop",["asyncToGeneratorRuntime","getLSVoprfInstance"],(function(a,b,c,d,e,f,g){"use strict";var h=window.crypto||window.msCrypto;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield c("getLSVoprfInstance")());b=a.voprfInfo;a=a.voprfWasm;a=a.getCurveBytes(b);b=new Uint8Array(a);h.getRandomValues(b);return[b.buffer]});function d(b,c){return a.apply(this,arguments)}return d}();g["default"]=a}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.db.table(310).fetch([[[a[0]]]]).next().then(function(a,e){var h=a.done;a=a.value;return h?(function(a){c.logger(a).mustfix(a)}("Request context for the passed task_id was not found"),h=[f,f],d[0]=h[0],d[1]=h[1],h):(e=a.item,c.seq([function(a){return d[7]=e.projectName,d[8]=e.maxClientTokenPoolSize,c.sp(b("LSGetCurrentTokenPoolState"),d[7]).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(a){return c.i64.eq(d[3],c.i64.cast([0,0]))||c.i64.eq(d[3],c.i64.cast([0,1]))?c.resolve((d[9]=new c.Map(),d[9].set("project_name",d[7]),d[10]=c.toJSON(d[9]),a=[d[10],c.i64.cast([0,351])],d[5]=a[0],d[6]=a[1],a)):c.seq([function(a){return d[9]=c.i64.of_float(Date.now()),c.islc(c.sb(c.ftr(c.db.table(307).fetch(),function(a){return a.projectName===d[7]&&c.i64.gt(a.expirationTimestampMs,d[9])}),[["expirationTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,i){var a=e.done;e=e.value;return a?(function(a){c.logger(a).mustfix(a)}("A config for the passed project name was not found"),d[13]=new c.Map(),d[13].set("project_name",d[7]),d[13].set("max_client_token_pool_size",d[8]),d[14]=c.toJSON(d[13]),a=[d[14],c.i64.cast([0,362])],d[10]=a[0],d[11]=a[1],a):(i=e.item,c.seq([function(a){return d[20]=i.configId,d[13]=i.maxEvals,d[22]=i.tokenPollFrequencyMs,d[21]=i.maxClientTokenPoolSize,d[14]=c.i64.sub(d[8],d[4]),d[19]=c.i64.lt(d[13],d[14])?d[13]:d[14],d[15]=c.createArray(),c.i64.gt(d[19],c.i64.cast([0,0]))?c.loopAsync(d[19],function(a){return d[23]=a,c.seq([function(a){return c.nop(b("LSVoprfCreateNonce.nop")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.blobs.neq(d[24],f)?c.seq([function(a){return c.nop(b("LSVoprfBlind.nop"),d[24]).then(function(a){return a=a,d[25]=a[0],d[26]=a[1],a})},function(a){return c.blobs.neq(d[25],f)?c.blobs.neq(d[26],f)?c.seq([function(a){return d[27]=c.i64.cast([-1,4294967295]),c.db.table(308).peekNextAutoIncrementId().then(function(a){return d[27]=a})},function(a){return c.db.table(308).add({tokenId:void 0,blindedNonce:d[25],blindingFactor:d[26],nonce:d[24],configId:d[20]})},function(a){return c.db.table(308).fetch([[[d[27]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[28]=c.i64.cast([-1,4294967295]):(e=b.item,d[28]=e.tokenId)})},function(a){return c.i64.eq(d[28],c.i64.cast([-1,4294967295]))?c.seq([function(a){return c.islc(c.db.table(308).fetchDesc([[[{gt:c.i64.cast([0,0])}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?d[33]=c.i64.cast([-1,4294967295]):(e=b.item,d[33]=e.tokenId)})},function(a){return d[30]=d[33]}]):c.resolve(d[30]=d[28])},function(a){return c.nop(b("LSBase64Encode.nop"),d[25]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[32]=new c.Map(),d[32].set("id",d[30]),d[32].set("data",d[31]==null?"":d[31]),d[33]=(d[15].push(d[32]),d[15])}]):c.resolve():c.resolve()}]):c.resolve()}])}):c.resolve()},function(a){return d[16]=c.i64.of_int32(d[15].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.resolve((d[23]=new c.Map(),d[23].set("project_name",d[7]),d[23].set("config_id",d[20]),d[23].set("blinded_nonces",d[15]),d[24]=c.toJSON(d[23]),a=[d[24],c.i64.cast([0,354])],d[17]=a[0],d[18]=a[1],a)):c.seq([function(a){return c.i64.neq(d[22],f)?c.seq([function(a){return c.i64.neq(d[21],f)?c.seq([function(a){return function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",d[7]].join("")),c.sp(b("LSIssueNextSync"),d[21],d[7],d[22],!1)},function(a){return a=[f,f],d[25]=a[0],d[26]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[7]].join("")),d[27]=new c.Map(),d[27].set("project_name",d[7]),d[27].set("max_client_token_pool_size",d[8]),d[28]=c.toJSON(d[27]),a=[d[28],c.i64.cast([0,362])],d[25]=a[0],d[26]=a[1],a))},function(a){return a=[d[25],d[26]],d[23]=a[0],d[24]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[7]].join("")),d[25]=new c.Map(),d[25].set("project_name",d[7]),d[25].set("max_client_token_pool_size",d[8]),d[26]=c.toJSON(d[25]),a=[d[26],c.i64.cast([0,362])],d[23]=a[0],d[24]=a[1],a))},function(a){return a=[d[23],d[24]],d[17]=a[0],d[18]=a[1],a}])},function(a){return a=[d[17],d[18]],d[10]=a[0],d[11]=a[1],a}]))})},function(a){return a=[d[10],d[11]],d[5]=a[0],d[6]=a[1],a}])},function(a){return a=[d[5],d[6]],d[0]=a[0],d[1]=a[1],a}]))})},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSMailboxTaskCompletionApiOnTaskCompletion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(233).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({success:a[1]})})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){a=d("ACSCipherSuiteModule").getACSCipherSuiteByValue(d("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!a)return(h||(h=b("Promise"))).resolve([void 0]);c=(yield d("ACSTokenHmacUtil").hmac(a.macAlgorithm,new Uint8Array(f).slice(),new TextEncoder().encode(e)));return(h||(h=b("Promise"))).resolve([c.buffer])});function c(b,c,d,e){return a.apply(this,arguments)}return c}();g["default"]=a}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return a[1]!==f?c.seq([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]="":(b=a.item,d[2]=b.projectName)})},function(a){return d[4]=c.createArray(),d[5]=c.i64.of_float(Date.now()),c.fe(c.ftr(c.db.table(307).fetch(),function(a){return d[2]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[5])}),function(a){a=a.item;return d[10]=(d[4].push(a.configId),d[4])})},function(a){return c.seq([function(a){return d[10]=c.createArray(),d[11]=c.i64.of_int32(d[4].length),c.i64.gt(d[11],c.i64.cast([0,0]))?c.loopAsync(d[11],function(a){return d[13]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[4],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return d[16]=(d[10].push(d[14]),d[10])}])}):c.resolve()},function(a){return d[12]=d[10].join(","),d[6]=d[12]}])},function(e){return c.ftr(c.db.table(309).fetch(),function(a){return d[4].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(e,h){var i=e.done;e=e.value;return i?c.seq([function(d){return c.sp(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[10]=c.createArray(),d[11]=(d[10].push("Unauthenticated Task Serializer: no valid tokens"),d[10]),d[12]=(d[10].push(a[0]),d[10]),d[13]=(d[10].push(d[2]),d[10]),d[14]=c.toJSON(d[10]),function(a){c.logger(a).mustfix(a)}(d[14]),b=[f,f],d[7]=b[0],d[8]=b[1],b}]):(h=e.item,c.seq([function(e){return d[13]=h.tokenId,c.nop(b("LSVoprfHmac.nop"),a[2]==null?"":a[2],h.sharedSecret).then(function(a){return a=a,d[10]=a[0],a})},function(e){return c.blobs.neq(d[10],f)?c.seq([function(a){return c.fe(c.db.table(309).fetch([[[d[13]]]]),function(a){var b=a.update;a=a.item;return b({redeemLimit:c.i64.sub(a.redeemLimit,c.i64.cast([0,1]))})})},function(a){return c.nop(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),h.nonce).then(function(a){return a=a,d[15]=a[0],a})},function(b){return d[16]=new c.Map(),d[16].set("config_id",h.configId),d[16].set("tag",d[14]==null?"":d[14]),d[16].set("aux",d[15]==null?"":d[15]),d[16].set("project_name",d[2]),d[17]=c.toJSON(d[16]),d[18]=new c.Map(),d[18].set("payload",a[2]==null?"":a[2]),d[18].set("token",d[17]),d[19]=c.toJSON(d[18]),b=[d[19],c.i64.from_string(a[1])],d[11]=b[0],d[12]=b[1],b}]):c.seq([function(a){return c.fe(c.db.table(309).fetch([[[d[13]]]]),function(a){return a["delete"]()})},function(d){return c.sp(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[14]=c.createArray(),d[15]=(d[14].push("Unauthenticated Task Serializer: hmac failed"),d[14]),d[16]=(d[14].push(a[0]),d[14]),d[17]=c.toJSON(d[14]),function(a){c.logger(a).mustfix(a)}(d[17]),b=[f,f],d[11]=b[0],d[12]=b[1],b}])},function(a){return a=[d[11],d[12]],d[7]=a[0],d[8]=a[1],a}]))})},function(a){return a=[d[7],d[8]],d[0]=a[0],d[1]=a[1],a}]):c.seq([function(d){return c.sp(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[2]=c.createArray(),d[3]=(d[2].push("Unauthenticated Task Serializer: task has no write label"),d[2]),d[4]=(d[2].push(a[0]),d[2]),d[5]=c.toJSON(d[2]),function(a){c.logger(a).mustfix(a)}(d[5]),b=[f,f],d[0]=b[0],d[1]=b[1],b}])},function(a){return c.sp(b("LSRemoveUsedTokens"))},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1];c.n;var d=[],e;return a=[e,c.i64.cast([0,705])],d[0]=a[0],d[1]=a[1],a,c.resolve(d)}b=a;f["default"]=b}),66);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1];c.n;var d=[],e;return a=[e,c.i64.cast([0,700])],d[0]=a[0],d[1]=a[1],a,c.resolve(d)}b=a;f["default"]=b}),66);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1];c.n;var d=[],e;return a=[e,c.i64.cast([0,319])],d[0]=a[0],d[1]=a[1],a,c.resolve(d)}b=a;f["default"]=b}),66);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(a){return c.seq([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),d[2]=c.createArray(),f!==f?d[10]=(d[2].push(f),d[2]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure","LSEncryptedBackupsLoopingUploadPayloadsTable table not found",d[2],c.i64.cast([0,3]))},function(a){return d[3]=c.i64.of_float(Date.now()),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",d[4],d[5],d[4],d[6],d[4],d[8]].join("")),d[7]=",",d[9]=c.createArray(),f!==f?d[10]=(d[9].push(f),d[9]):0,c.nop(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[d[5],d[7],d[6],d[7],d[8]].join(""),d[9],c.i64.cast([0,4]))},function(a){return a=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',c.i64.cast([0,50043])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSGetOpenEpochKeys",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSDeleteBackupOnClient","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return d[1]?d[3]=c.i64.or_(c.i64.cast([0,90]),c.i64.cast([0,128])):d[3]=c.i64.cast([0,90]),c.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[5],"EncryptedBackups MCD Trace ID",d[5],c.i64.to_string(d[3])].join("")),c.sp(b("LSCreateDataTrace"),d[4],f,f,"get_open_epoch_keys",d[3])},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[6]?d[7]=!0:d[7]=!1,d[7]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),f!==f?d[28]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(e){return a[0]?d[8]="OPTIMISTIC":d[8]="AUTHORITATIVE",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[9],"Querying latest epoch keys with authority level: ",d[9],d[8]].join("")),a[0]?d[10]="OPTIMISTIC":d[10]="AUTHORITATIVE",d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2842]),c.i64.cast([0,2]),f,d[10]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),f!==f?d[28]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2844]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),f!==f?d[28]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(b){return d[15]=c.createArray(),c.fe(c.ftr(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[27]=(d[15].push(c.blobs.to_string(a.epochAnonIdBlob)),d[15])})},function(a){return d[16]=c.i64.of_int32(d[15].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.seq([function(a){return d[27]=c.i64.of_int32(d[15].length),d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2845]),c.i64.cast([0,2]),f,c.i64.to_string(d[27])):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()},function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[15],c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],d[31]=a[1],a})},function(a){return d[32]=d[30],d[33]=c.i64.of_int32(d[15].length),c.i64.gt(d[33],c.i64.cast([0,0]))?c.loopAsync(d[33],function(a){return d[34]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[15],d[34]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],a})},function(a){return c.i64.eq([0,d[32].length],[0,d[35].length])?(d[32]===d[35]?d[38]=d[32]:(d[32]>d[35]?d[39]=d[32]:d[39]=d[35],d[38]=d[39]),d[37]=d[38]):(c.i64.gt([0,d[32].length],[0,d[35].length])?d[38]=d[32]:d[38]=d[35],d[37]=d[38]),d[32]=d[37]}])}):c.resolve()},function(a){return d[17]=d[32]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Epoch anon ID list is empty."),d[27]=c.createArray(),f!==f?d[30]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure","Epoch anon ID list is empty.",d[27],c.i64.cast([0,3]))},function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2846]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),f!==f?d[31]=(d[30].push(f),d[30]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]=f}])},function(a){return d[17]!==f?c.seq([function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2863]),c.i64.cast([0,2]),f,d[17]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),f!==f?d[30]=(d[29].push(f),d[29]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2864]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),f!==f?d[30]=(d[29].push(f),d[29]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[26]=c.blobs.of_string(d[17]),c.blobs.neq(d[26],f)?c.seq([function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2847]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),f!==f?d[32]=(d[31].push(f),d[31]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()},function(a){return c.ftr(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[26])}).next().then(function(a,e){var h=a.done;a=a.value;return h?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction."),d[31]=c.createArray(),f!==f?d[34]=(d[31].push(f),d[31]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure","Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction.",d[31],c.i64.cast([0,3]))},function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2848]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()},function(a){return d[29]=f}]):(e=a.item,d[33]=e.epochAnonIdBlob,d[31]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[31],"Using latest epoch: ",d[31],c.blobs.to_string(d[33])].join("")),d[32]=new c.Map(),d[32].set("epoch_id",e.epochId),d[32].set("epoch_root_key",e.epochRootKeyBlob),d[32].set("epoch_anon_id",d[33]),d[29]=d[32])})},function(a){return d[18]=d[29]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client."),d[27]=c.createArray(),f!==f?d[30]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure","No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client.",d[27],c.i64.cast([0,3]))},function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2843]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),f!==f?d[31]=(d[30].push(f),d[30]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()},function(a){return c.sp(b("LSDeleteBackupOnClient"),f,"get_open_epoch_keys",!0,d[4],"Attempted to fetch epoch keys when there are no epochs on the client.",!1)},function(a){return d[18]=f}])},function(a){return d[19]=c.i64.of_float(Date.now()),d[21]="Finishing execution. Execution time: ",d[22]=c.i64.to_string(c.i64.sub(d[19],d[0])),d[24]=" ms",d[20]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[20],d[21],d[20],d[22],d[20],d[24]].join("")),d[23]=",",d[25]=c.createArray(),f!==f?d[27]=(d[25].push(f),d[25]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",[d[21],d[23],d[22],d[23],d[24]].join(""),d[25],c.i64.cast([0,4]))},function(a){return e[0]=d[18]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",["LSAppendDataTraceAddon","LSBase64Encode.nop","LSGetOpenEpochKeys","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] Beginning execution."),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] Fetching locally available epochs on client from epochs table"),d[1]=c.createArray(),c.fe(c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[14]=(d[1].push(a.epochId),d[1])})},function(e){return d[2]=c.i64.of_int32(d[1].length),d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[3],"Queried locally available epochs. Count: ",d[3],c.i64.to_string(d[2])].join("")),c.db.table(168).fetch().next().then(function(e,h){var i=e.done;e=e.value;return i?(i=[f,f],d[4]=i[0],d[5]=i[1],i):(h=e.item,c.seq([function(e){return d[16]=h.deviceId,c.i64.neq(d[16],f)?c.seq([function(e){return c.db.table(190).fetch([[[a[0]]]]).next().then(function(e,j){var a=e.done;e=e.value;return a?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] No restore payload context found."),d[20]=c.createArray(),f!==f?d[21]=(d[20].push(f),d[20]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure","No restore payload context found.",d[20],c.i64.cast([0,3]))},function(a){return a=[f,f],d[17]=a[0],d[18]=a[1],a}]):(j=e.item,c.seq([function(a){return d[30]=j.traceId,d[30]!==f?c.sp(b("LSAppendDataTraceAddon"),d[30],c.i64.cast([0,3603]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),f!==f?d[32]=(d[31].push(f),d[31]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()},function(a){return d[22]=new c.Map(),d[22].set("server_thread_key",j.serverThreadKey),d[22].set("otid",j.messageId),d[22].set("timestamp",j.unencryptedSortKey),d[22].set("wa_thread_id",j.waThreadId),c.nop(b("LSBase64Encode.nop"),h.ocmfClientStateBlob).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),h.mailboxRootKeyBlob).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[25]=new c.Map(),d[25].set("ocmf_client_state_blob",d[23]==null?"":d[23]),d[25].set("mailbox_root_key",d[24]==null?"":d[24]),c.sp(b("LSGetOpenEpochKeys"),!1).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]!==f?(d[31]=d[26].get("epoch_id"),d[26],d[27]=d[31]):d[27]=f,d[28]=new c.Map(),d[28].set("content_type",j.contentType),d[28].set("device_id",d[16]),d[28].set("epoch_id",d[27]),d[28].set("list_id",j.listId),d[28].set("num_items",j.numItems),d[28].set("start_sort_key",j.startSortKey),d[28].set("mailbox_partial_id",j.mailboxPartialId),d[28].set("trace_id",d[30]),d[28].set("message_partial_id",j.messagePartialId),d[28].set("newer_num_items",j.newerNumItems),d[28].set("locally_available_epochs",d[1]),d[28].set("raw_identifiers",d[22]),d[28].set("raw_tokens",d[25]),d[29]=c.toJSON(d[28]),a=[d[29],c.i64.cast([0,50015])],d[17]=a[0],d[18]=a[1],a}]))})},function(a){return a=[d[17],d[18]],d[14]=a[0],d[15]=a[1],a}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] Unexpected error: Device ID is null."),d[17]=c.createArray(),f!==f?d[18]=(d[17].push(f),d[17]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure","Unexpected error: Device ID is null.",d[17],c.i64.cast([0,3]))},function(a){return a=[f,f],d[14]=a[0],d[15]=a[1],a}])},function(a){return a=[d[14],d[15]],d[4]=a[0],d[5]=a[1],a}]))})},function(a){return d[7]=c.i64.of_float(Date.now()),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] ",d[8],d[9],d[8],d[10],d[8],d[12]].join("")),d[11]=",",d[13]=c.createArray(),f!==f?d[14]=(d[13].push(f),d[13]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure",[d[9],d[11],d[10],d[11],d[12]].join(""),d[13],c.i64.cast([0,4]))},function(a){return a=[d[4],d[5]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSEncryptIdentifiers",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptIdentifiers] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("backup_id"),a[2],d[3]=a[3].get("ocmf_shared_key"),a[3],c.nop(b("LSGetBlobFromString.nop"),d[2]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[4]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[3],d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[6]).then(function(a){return a=a,d[7]=a[0],a})},function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))&&c.i64.eq(a[1],c.i64.cast([0,2]))?(d[34]=a[2].get("otid"),a[2],d[8]=d[34]):(d[34]=a[2].get("act_thread_id"),a[2],d[8]=d[34]),d[9]=a[3].get("ocmf_shared_key"),a[3],c.nop(b("LSGetBlobFromString.nop"),d[8]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[9],d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[12]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return d[14]=a[3].get("ope_key"),a[3],d[15]=a[2].get("timestamp"),a[2],c.nop(b("LSGetBlobFromInt64BE.nop"),c.i64.from_string(d[15])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nop(b("LSTruncateSortKey.nop"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nop(b("LSOpeEncrypt.nop"),d[14],d[17],c.i64.cast([0,16])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nop(b("LSBinaryToHex.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(e){return d[20]=a[2].get("otid"),a[2],d[21]=a[3].get("ocmf_shared_key"),a[3],c.nop(b("LSGetBlobFromString.nop"),d[20]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[21],d[23]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("backup_id_ocmf_partial",d[7]==null?"":d[7]),d[26].set("act_thread_id_ocmf_partial",d[13]==null?"":d[13]),d[26].set("timestamp_encrypted",d[19]==null?"":d[19]),d[26].set("otid_ocmf_partial",d[25]==null?"":d[25]),d[27]=c.i64.of_float(Date.now()),d[29]="Finishing execution. Execution time: ",d[30]=c.i64.to_string(c.i64.sub(d[27],d[0])),d[32]=" ms",d[28]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptIdentifiers] ",d[28],d[29],d[28],d[30],d[28],d[32]].join("")),d[31]=",",d[33]=c.createArray(),f!==f?d[34]=(d[33].push(f),d[33]):0,c.nop(b("LSLogMebClientEvent.nop"),"encryptIdentifiers",[d[29],d[31],d[30],d[31],d[32]].join(""),d[33],c.i64.cast([0,4]))},function(a){return a=[d[26],f],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("Base64Utils",["base64Binary"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("base64Binary").encode(new TextEncoder().encode(a))}function b(a){return d("base64Binary").encode(new Uint8Array(a))}function c(a){return d("base64Binary").decode(a).buffer}g.encodeUnicode=a;g.fromArrayBuffer=b;g.toArrayBuffer=c}),98);
__d("LSSymmetricEncryptionCreateEncryptedData.bs",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","globalCryptoSubtle"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_data"),k=d("SymmetricEncryptionPaddingUtils").padData(i),l=window.crypto.getRandomValues(new Uint8Array(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes));a=new(d("HChaCha20").HChaCha20)();e=a.hChaCha20Bytes(l.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,f);return c("globalCryptoSubtle").importKey("raw",e,"AES-GCM",!1,["encrypt"]).then(function(a){return c("globalCryptoSubtle").encrypt({additionalData:g,iv:new Uint8Array(l.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,k)}).then(function(a){var c=l.byteLength+a.byteLength|0;c=new Uint8Array(c);c.set(l);c.set(new Uint8Array(a),d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(c.buffer))})["catch"](function(a){d("CryptoLogger").captureError(j,a).mustfix("symmetric data encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})}g.call=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.bs",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.bs","Promise","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c,e,f,g){var i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return d("LSSymmetricEncryptionCreateEncryptedData.bs").call(a,c,e,f,d("LSCryptoUtils").strToBuf(g)).then(function(a){return a[0]}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a?d("Base64Utils").fromArrayBuffer(a):void 0))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric string encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})}g.call=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["LSSymmetricEncryptionCreateEncryptedString.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f){return d("LSSymmetricEncryptionCreateEncryptedString.bs").call(a,b,c,e,f)};g["default"]=a}),98);
__d("LSEncryptMessagePayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptMessagePayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[1].get("message_payload_encryption_keys"),a[1],d[3]=d[2].get("payload_key"),d[2],d[4]=a[0].get("act_thread_id"),a[0],c.nop(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[3],c.blobs.of_string(["message_thread","_",d[4]].join("")),a[2]).then(function(a){return a=a,d[5]=a[0],a})},function(e){return d[5]!==f?c.seq([function(e){return d[15]=d[2].get("encryption_version"),d[2],d[16]=d[2].get("epoch_anon_id"),d[2],d[17]=d[2].get("epoch_root_key"),d[2],d[18]=a[0].get("act_thread_id"),a[0],d[19]=d[2].get("payload_key"),d[2],d[20]=a[0].get("backup_id"),a[0],d[21]=d[2].get("payload_fallback_key"),d[2],d[22]=c.createArray(),d[52]=(d[22].push(c.i64.cast([0,6])),d[22]),c.nop(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[23],f,d[16],d[22]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!1:d[25]=!0,d[25]?c.resolve(d[26]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[24],c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[26]=d[54]==null?"":d[54]}])},function(a){return d[27]=c.createArray(),d[52]=(d[27].push(c.i64.cast([0,6])),d[27]),c.nop(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[28],f,d[17],d[27]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!1:d[30]=!0,d[30]?c.resolve(d[31]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[31]=d[54]==null?"":d[54]}])},function(a){return d[32]=c.createArray(),d[52]=(d[32].push(c.i64.cast([0,6])),d[32]),c.nop(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[33],f,d[19],d[32]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[35]=!1:d[35]=!0,d[35]?c.resolve(d[36]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[34],c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[36]=d[54]==null?"":d[54]}])},function(a){return c.nop(b("LSBase64Encode.nop"),d[17]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nop(b("LSGetBlobFromString.nop"),[d[37]==null?"":d[37],d[18]].join("")).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[39]=c.createArray(),d[52]=(d[39].push(c.i64.cast([0,6])),d[39]),c.nop(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[40],f,d[38],d[39]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[42]=!1:d[42]=!0,d[42]?c.resolve(d[43]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[41],c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[43]=d[54]==null?"":d[54]}])},function(a){return d[44]=":",d[51]=[d[26],d[44],d[31],d[44],d[36],d[44],d[43]].join(""),c.blobs.neq(d[17],f)?c.seq([function(a){return d[52]=c.createArray(),d[58]=(d[52].push(c.i64.cast([0,18])),d[52]),c.nop(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),f,d[17],d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]!==f?c.seq([function(a){return d[58]=c.i64.of_int32(d[53].length),c.i64.ge(d[58],c.i64.cast([0,1]))?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[53],c.i64.cast([0,0])).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[59]=d[60]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[60]=c.createArray(),f!==f?d[61]=(d[60].push(f),d[60]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[60],c.i64.cast([0,3]))},function(a){return d[59]=f}])},function(a){return d[54]=d[59]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[58]=c.createArray(),f!==f?d[59]=(d[58].push(f),d[58]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[58],c.i64.cast([0,3]))},function(a){return d[54]=f}])},function(a){return c.blobs.neq(d[54],f)?d[55]=!0:d[55]=!1,d[55]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nop(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]!==f?d[57]=d[56]:d[57]="encodingfailed",d[45]=d[57]}]):c.resolve(d[45]="null")},function(a){return c.nop(b("LSBase64Encode.nop"),d[16]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[50]=d[46]==null?"":d[46],c.blobs.neq(d[21],f)?c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][MEBSerializationUtils] Including fallback encrypted epoch key in value_secret_ref."),c.nop(b("LSBase64Encode.nop"),d[17]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[21],c.blob("ZmFsbGJhY2tfZW5jcnlwdGVkX2Vwb2NoX2tleQ=="),d[52]==null?"":d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]!==f?d[54]=d[53]:d[54]="",d[55]=new c.Map(),d[55].set("encryption_version",d[15]),d[55].set("epoch_anon_id",d[50]),d[55].set("message_encryption_values",d[51]),d[55].set("fallback_encrypted_epoch_key",d[54]),d[55].set("root_key_fingerprint",d[45]),d[55].set("backup_id",d[20]),d[47]=d[55]}]):c.resolve((d[52]=new c.Map(),d[52].set("encryption_version",d[15]),d[52].set("epoch_anon_id",d[50]),d[52].set("message_encryption_values",d[51]),d[52].set("root_key_fingerprint",d[45]),d[52].set("backup_id",d[20]),d[47]=d[52]))},function(a){return d[48]=c.toJSON(d[47]),d[49]=new c.Map(),d[49].set("encrypted_message_payload",d[5]),d[49].set("value_secret_ref",d[48]),a=[d[49],f],d[6]=a[0],d[7]=a[1],a}]):c.resolve((d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,40])),d[15].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadStoredProcedure"),d[15].set("error_message",""),e=[f,d[15]],d[6]=e[0],d[7]=e[1],e))},function(a){return d[8]=c.i64.of_float(Date.now()),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[13]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptMessagePayload] ",d[9],d[10],d[9],d[11],d[9],d[13]].join("")),d[12]=",",d[14]=c.createArray(),f!==f?d[15]=(d[14].push(f),d[14]):0,c.nop(b("LSLogMebClientEvent.nop"),"encryptMessagePayload",[d[10],d[12],d[11],d[12],d[13]].join(""),d[14],c.i64.cast([0,4]))},function(a){return a=[d[6],d[7]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]="",d[3]=f,d[4]=f,a[0]?c.resolve(0):c.i64.neq(f,f)?c.db.table(169).fetch([[[f]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?0:(b=a.item,d[2]=c.blobs.to_string(b.epochAnonIdBlob),d[3]=b.epochId,d[4]=b.epochRootKeyBlob)}):c.resolve()},function(b){return c.i64.neq(d[3],f)?c.resolve(0):c.fe(c.ftr(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[16]=c.blobs.to_string(a.epochAnonIdBlob),c.i64.eq([0,d[16].length],[0,d[2].length])?d[15]=d[16]>d[2]:d[15]=c.i64.gt([0,d[16].length],[0,d[2].length]),d[15]?(d[2]=d[16],d[3]=a.epochId,d[4]=a.epochRootKeyBlob):0})},function(a){return d[14]=c.blobs.of_string(d[2]),c.i64.neq(d[3],f)?(c.blobs.neq(d[14],f)?(c.blobs.neq(d[4],f)?(d[19]=new c.Map(),d[19].set("epoch_id",d[3]),d[19].set("epoch_root_key",d[4]),d[19].set("epoch_anon_id",d[14]),d[20]=new c.Map(),d[20].set("epoch_keys",d[19]),a=[d[20],f],d[17]=a[0],d[18]=a[1],a):(d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,402])),d[19].set("error_message","failed to query latest epoch"),d[19].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[f,d[19]],d[17]=a[0],d[18]=a[1],a),a=[d[17],d[18]],d[15]=a[0],d[16]=a[1],a):(d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,403])),d[17].set("error_message","failed to query latest epoch"),d[17].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[f,d[17]],d[15]=a[0],d[16]=a[1],a),a=[d[15],d[16]],d[5]=a[0],d[6]=a[1],a):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,400])),d[15].set("error_message","failed to query latest epoch"),d[15].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[f,d[15]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getLatestEpochKeys] ",d[8],d[9],d[8],d[10],d[8],d[12]].join("")),d[11]=",",d[13]=c.createArray(),f!==f?d[15]=(d[13].push(f),d[13]):0,c.nop(b("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[d[9],d[11],d[10],d[11],d[12]].join(""),d[13],c.i64.cast([0,4]))},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSLoadAndEncryptProtobufWithInputs",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(a){return c.seq([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufWithInputs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error NOT_SUPPORTED_ON_WEB"),d[2]=new c.Map(),d[2].set("error_code",c.i64.cast([0,7])),d[2].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),d[2].set("error_message",""),d[3]=c.i64.of_float(Date.now()),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufWithInputs] ",d[4],d[5],d[4],d[6],d[4],d[8]].join("")),d[7]=",",d[9]=c.createArray(),f!==f?d[10]=(d[9].push(f),d[9]):0,c.nop(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputs",[d[5],d[7],d[6],d[7],d[8]].join(""),d[9],c.i64.cast([0,4]))},function(a){return a=[f,d[2]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSLoadAndEncryptProtobuf",["LSLoadAndEncryptProtobufWithInputs","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobuf] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.ftr(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,g){var h=e.done;e=e.value;return h?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufStoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),d[12]=new c.Map(),d[12].set("error_code",c.i64.cast([0,67])),d[12].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufStoredProcedure"),d[12].set("error_message",""),h=[f,d[12]],d[2]=h[0],d[3]=h[1],h):(g=e.item,c.seq([function(e){return c.sp(b("LSLoadAndEncryptProtobufWithInputs"),g.backupAction,g.actThreadId,g.toplevelOfflineThreadingId,g.supplementalKey,g.messageTimestampMs,a[1],a[2]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return a=[d[12],d[13]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobuf] ",d[6],d[7],d[6],d[8],d[6],d[10]].join("")),d[9]=",",d[11]=c.createArray(),f!==f?d[12]=(d[11].push(f),d[11]):0,c.nop(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobuf",[d[7],d[9],d[8],d[9],d[10]].join(""),d[11],c.i64.cast([0,4]))},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;g["default"]=c}),98);
__d("LSSerializeBackupPayloadV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSEncryptIdentifiers","LSEncryptMessagePayload","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSIsMobileClient","LSLoadAndEncryptProtobuf","LSLogMebClientEvent.nop","gkx","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1];d.n;var e=[],f=[],g;return d.seq([function(h){return d.seq([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),e[1]=d.i64.of_float(Date.now()),e[13]=d.i64.mul(e[1],d.i64.cast([0,1e6])),(c("gkx")("7350")||c("gkx")("4765"))&&c("justknobx")._("1071")?d.seq([function(c){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(c,f){var i=c.done;c=c.value;return i?d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[31]=d.i64.of_float(Date.now()),b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[31],d.i64.cast([0,1e6])),e[13]),g],e[19]=b[0],e[20]=b[1],e[21]=b[2],e[22]=b[3],e[23]=b[4],e[24]=b[5],e[25]=b[6],b):(f=c.item,e[31]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[31],d.i64.cast([0,1e6])),e[13]),g],e[19]=b[0],e[20]=b[1],e[21]=b[2],e[22]=b[3],e[23]=b[4],e[24]=b[5],e[25]=b[6],b)})},function(a){return e[27]=new d.Map(),e[27].set("task_id",e[19]),e[27].set("queue_name",e[20]),e[27].set("enqueue_timestamp_ms",e[21]),e[27].set("priority",e[22]),e[27].set("first_executed_timestamp_ms",e[23]),e[27].set("execution_time_ns",e[24]),e[27].set("echo_encoding_execution_time_ns",e[25]),e[28]=new d.Map(),e[28].set("task_metadata",e[27]),e[28].set("action_type",g),e[28].set("content_type",g),e[28].set("identifiers",g),e[28].set("task_creation_source",g),e[28].set("message_payload_source",d.i64.cast([0,2])),e[29]=new d.Map(),e[29].set("error_code",d.i64.cast([0,1])),e[29].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[29].set("error_message",""),e[30]=d.createArray(),a=[g,e[29],e[28],e[30]],e[14]=a[0],e[15]=a[1],e[16]=a[2],e[17]=a[3],a}]):(f=c.item,d.seq([function(a){return e[28]=f.mailboxRootKeyBlob,e[29]=f.deviceId,e[27]=f.backupTenancy,e[26]=f.encryptionVersion,d.i64.neq(g,g)?d.resolve(e[19]=g):d.seq([function(a){return e[30]=d.createArray(),d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[40]=(e[30].push(d.i64.cast([0,0])),e[30]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[32]?e[40]=(e[30].push(d.i64.cast([0,2])),e[30]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[33]?e[40]=(e[30].push(d.i64.cast([0,3])),e[30]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[40]=(e[30].push(d.i64.cast([0,4])),e[30]):0,e[35]=d.createArray(),e[36]=d.i64.of_int32(e[30].length),d.i64.gt(e[36],d.i64.cast([0,0]))?d.loopAsync(e[36],function(a){return e[40]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[30],e[40]).then(function(a){return a=a,e[41]=a[0],e[42]=a[1],a})},function(a){return e[43]=(e[35].push(e[41]),e[35])}])}):d.resolve()},function(a){return d.seq([function(a){return e[40]=d.createArray(),e[41]=d.i64.of_int32(e[35].length),d.i64.gt(e[41],d.i64.cast([0,0]))?d.loopAsync(e[41],function(a){return e[43]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[35],e[43]).then(function(a){return a=a,e[44]=a[0],e[45]=a[1],a})},function(a){return e[46]=(e[40].push(d.i64.to_string(e[44])),e[40])}])}):d.resolve()},function(a){return e[42]=e[40].join(","),e[37]=e[42]}])},function(a){return e[35].some(function(a){return d.i64.eq(e[26],a)})?e[38]=e[26]:e[38]=g,d.i64.neq(e[38],g)?e[39]=e[38]:e[39]=g,e[19]=e[39]}])},function(c){return d.i64.neq(e[19],g)?e[20]=e[19]:e[20]=d.i64.cast([0,0]),d.i64.neq(e[27],g)?e[21]=e[27]:e[21]=d.i64.cast([0,1]),d.i64.neq(e[29],g)?d.seq([function(c){return d.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]).next().then(function(j,k){var c=j.done;j=j.value;return c?d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[47]=d.i64.of_float(Date.now()),b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[47],d.i64.cast([0,1e6])),e[13]),g],e[35]=b[0],e[36]=b[1],e[37]=b[2],e[38]=b[3],e[39]=b[4],e[40]=b[5],e[41]=b[6],b):(f=c.item,e[47]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[47],d.i64.cast([0,1e6])),e[13]),g],e[35]=b[0],e[36]=b[1],e[37]=b[2],e[38]=b[3],e[39]=b[4],e[40]=b[5],e[41]=b[6],b)})},function(a){return e[43]=new d.Map(),e[43].set("task_id",e[35]),e[43].set("queue_name",e[36]),e[43].set("enqueue_timestamp_ms",e[37]),e[43].set("priority",e[38]),e[43].set("first_executed_timestamp_ms",e[39]),e[43].set("execution_time_ns",e[40]),e[43].set("echo_encoding_execution_time_ns",e[41]),e[44]=new d.Map(),e[44].set("task_metadata",e[43]),e[44].set("action_type",g),e[44].set("content_type",g),e[44].set("identifiers",g),e[44].set("task_creation_source",g),e[44].set("message_payload_source",d.i64.cast([0,2])),e[45]=new d.Map(),e[45].set("error_code",d.i64.cast([0,5])),e[45].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[45].set("error_message","Pending backup context row not found"),e[46]=d.createArray(),a=[g,e[45],e[44],e[46]],e[30]=a[0],e[31]=a[1],e[32]=a[2],e[33]=a[3],a}]):(k=j.item,d.seq([function(a){return e[43]=k.actionType,e[42]=k.contentType,e[41]=k.listKey,e[44]=k.echoContent,e[45]=k.lsTraceId,e[46]=k.echoEncodingLatencyNs,d.i64.eq(e[43],d.i64.cast([0,2]))&&d.i64.eq(e[42],d.i64.cast([0,2]))?d.resolve(e[35]=""):d.seq([function(a){return d.db.table(173).fetch([[[d.i64.from_string(e[41])]],"jid"]).next().then(function(b,c){var a=b.done;b=b.value;return a?e[48]="":(c=b.item,e[48]=d.i64.to_string(c.serverThreadKey))})},function(a){return e[35]=e[48]}])},function(c){return e[36]=new d.Map(),e[36].set("backup_id",d.i64.to_string(f.backupId)),e[36].set("act_thread_id",e[41]),e[36].set("server_thread_id",e[35]),e[36].set("timestamp",k.sortKey),e[36].set("otid",k.uniqueKey),e[47]=k.error==null?d.i64.cast([0,0]):k.error,d.i64.eq(e[47],d.i64.cast([0,0]))?d.seq([function(a){return d.sp(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,e[48]=a[0],e[49]=a[1],a})},function(a){return e[48]!==g?d.seq([function(a){return d.i64.eq(e[42],d.i64.cast([0,1]))?d.seq([function(a){return e[59]=e[36].get("act_thread_id"),e[36],e[60]=d.createArray(),e[65]=(e[60].push(d.i64.cast([0,32])),e[60]),d.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[59]].join("")).then(function(a){return a=a,e[61]=a[0],a})},function(a){return d.nop(b("LSCreateDerivedKeys.nop"),e[61],g,e[28],e[60]).then(function(a){return a=a,e[62]=a[0],a})},function(a){return e[62]?e[63]=!1:e[63]=!0,e[63]?d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[65]=d.createArray(),g!==g?e[66]=(e[65].push(g),e[65]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[65],d.i64.cast([0,3]))},function(a){return e[64]=g}]):d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[62],d.i64.cast([0,0])).then(function(a){return a=a,e[65]=a[0],e[66]=a[1],a})},function(a){return e[64]=e[65]}])},function(a){return e[56]=e[64]}]):d.seq([function(a){return d.i64.eq(e[43],d.i64.cast([0,2]))?d.seq([function(a){return e[60]=e[36].get("otid"),e[36],e[61]=d.createArray(),e[66]=(e[61].push(d.i64.cast([0,32])),e[61]),d.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[60]].join("")).then(function(a){return a=a,e[62]=a[0],a})},function(a){return d.nop(b("LSCreateDerivedKeys.nop"),e[62],g,e[28],e[61]).then(function(a){return a=a,e[63]=a[0],a})},function(a){return e[63]?e[64]=!1:e[64]=!0,e[64]?d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[66]=d.createArray(),g!==g?e[67]=(e[66].push(g),e[66]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[66],d.i64.cast([0,3]))},function(a){return e[65]=g}]):d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[63],d.i64.cast([0,0])).then(function(a){return a=a,e[66]=a[0],e[67]=a[1],a})},function(a){return e[65]=e[66]}])},function(a){return e[59]=e[65]}]):d.resolve(e[59]=g)},function(a){return e[56]=e[59]}])},function(a){return d.blobs.neq(e[56],g)?d.seq([function(a){return e[59]=e[48].get("epoch_keys"),e[48],e[60]=e[59].get("epoch_anon_id"),e[59],e[61]=e[59].get("epoch_root_key"),e[59],e[62]=e[36].get("act_thread_id"),e[36],e[63]=d.createArray(),e[74]=(e[63].push(d.i64.cast([0,32])),e[63]),d.i64.ge(e[20],d.i64.cast([0,3]))?d.resolve(e[64]=g):d.seq([function(a){return d.nop(b("LSGetBlobFromString.nop"),e[62]).then(function(a){return a=a,e[74]=a[0],a})},function(a){return e[64]=e[74]}])},function(a){return d.i64.ge(e[20],d.i64.cast([0,4]))?(e[74]="_",e[65]=["message_key_in_epoch",e[74],d.blobs.to_string(e[60]),e[74],"cipher_version",e[74],d.i64.to_string(e[20]),e[74],"thread",e[74],e[62]==null?"":e[62]].join("")):(d.i64.ge(e[20],d.i64.cast([0,3]))?(e[75]="_",e[74]=["message_key_in_epoch",e[75],d.blobs.to_string(e[60]),e[75],"cipher_version",e[75],d.i64.to_string(e[20]),e[75],"thread",e[75],e[62]==null?"":e[62]].join("")):(d.i64.ge(e[20],d.i64.cast([0,2]))?(e[76]="_",e[75]=["message_key_in_epoch",e[76],d.blobs.to_string(e[60]),e[76],"cipher_version",e[76],d.i64.to_string(e[20])].join("")):e[75]=["message_key_in_epoch","_",d.blobs.to_string(e[60])].join(""),e[74]=e[75]),e[65]=e[74]),d.nop(b("LSGetBlobFromString.nop"),e[65]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return d.nop(b("LSCreateDerivedKeys.nop"),e[66],e[64],e[61],e[63]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return e[67]?e[68]=!1:e[68]=!0,e[68]?d.resolve(e[69]=g):d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[67],d.i64.cast([0,0])).then(function(a){return a=a,e[74]=a[0],e[75]=a[1],a})},function(a){return e[69]=e[74]}])},function(a){return d.ftr(d.db.table(169).fetch(),function(a){return d.blobs.eq(a.epochAnonIdBlob,d.blob("MA=="))}).next().then(function(c,f){var a=c.done;c=c.value;return a?d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),e[74]=d.createArray(),g!==g?e[75]=(e[74].push(g),e[74]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get mailbox_root_key_v2: epoch 0 is not available.",e[74],d.i64.cast([0,3]))},function(a){return e[70]=g}]):(f=c.item,d.seq([function(a){return e[74]=d.createArray(),e[82]=(e[74].push(d.i64.cast([0,32])),e[74]),d.nop(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),g,e[28],e[74]).then(function(a){return a=a,e[75]=a[0],a})},function(a){return e[75]!==g?d.seq([function(a){return e[82]=d.i64.of_int32(e[75].length),d.i64.ge(e[82],d.i64.cast([0,1]))?d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[75],d.i64.cast([0,0])).then(function(a){return a=a,e[84]=a[0],e[85]=a[1],a})},function(a){return e[83]=e[84]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[84]=d.createArray(),g!==g?e[85]=(e[84].push(g),e[84]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[84],d.i64.cast([0,3]))},function(a){return e[83]=g}])},function(a){return e[76]=e[83]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[82]=d.createArray(),g!==g?e[83]=(e[82].push(g),e[82]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[82],d.i64.cast([0,3]))},function(a){return e[76]=g}])},function(a){return d.blobs.neq(e[76],g)?e[77]=!0:e[77]=!1,e[77]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[78]=d.createArray(),e[82]=(e[78].push(d.i64.cast([0,32])),e[78]),d.nop(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),e[76],f.epochRootKeyBlob,e[78]).then(function(a){return a=a,e[79]=a[0],a})},function(a){return e[79]!==g?d.seq([function(a){return e[82]=d.i64.of_int32(e[79].length),d.i64.ge(e[82],d.i64.cast([0,1]))?d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[79],d.i64.cast([0,0])).then(function(a){return a=a,e[84]=a[0],e[85]=a[1],a})},function(a){return e[83]=e[84]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[84]=d.createArray(),g!==g?e[85]=(e[84].push(g),e[84]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[84],d.i64.cast([0,3]))},function(a){return e[83]=g}])},function(a){return e[80]=e[83]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[82]=d.createArray(),g!==g?e[83]=(e[82].push(g),e[82]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[82],d.i64.cast([0,3]))},function(a){return e[80]=g}])},function(a){return d.blobs.neq(e[80],g)?e[81]=!0:e[81]=!1,e[81]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[70]=e[80]}]))})},function(a){return d.blobs.neq(e[69],g)?d.seq([function(a){return d.blobs.neq(e[70],g)?d.seq([function(a){return e[80]=d.createArray(),e[84]=(e[80].push(d.i64.cast([0,32])),e[80]),d.nop(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),g,e[70],e[80]).then(function(a){return a=a,e[81]=a[0],a})},function(a){return e[81]!==g?d.seq([function(a){return e[84]=d.i64.of_int32(e[81].length),d.i64.ge(e[84],d.i64.cast([0,1]))?d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[81],d.i64.cast([0,0])).then(function(a){return a=a,e[86]=a[0],e[87]=a[1],a})},function(a){return e[85]=e[86]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[86]=d.createArray(),g!==g?e[87]=(e[86].push(g),e[86]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[86],d.i64.cast([0,3]))},function(a){return e[85]=g}])},function(a){return e[82]=e[85]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[84]=d.createArray(),g!==g?e[85]=(e[84].push(g),e[84]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[84],d.i64.cast([0,3]))},function(a){return e[82]=g}])},function(a){return d.blobs.neq(e[82],g)?e[83]=!0:e[83]=!1,e[83]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[74]=e[82]}]):d.resolve(e[74]=g)},function(a){return e[75]=e[59].get("epoch_root_key"),e[59],e[76]=e[59].get("epoch_anon_id"),e[59],e[77]=e[59].get("epoch_id"),e[59],e[78]=new d.Map(),e[78].set("payload_key",e[69]),e[78].set("payload_fallback_key",e[74]),e[78].set("encryption_version",e[20]),e[78].set("epoch_root_key",e[75]),e[78].set("epoch_anon_id",e[76]),e[78].set("epoch_id",e[77]),e[79]=new d.Map(),e[79].set("ope_key",e[56]),e[79].set("message_payload_encryption_keys",e[78]),e[79].set("ocmf_shared_key",f.ocmfClientStateBlob),e[79].set("mailbox_base_salt",e[28]),e[79].set("mailbox_root_key_v2",e[70]),a=[e[79],g],e[72]=a[0],e[73]=a[1],a}]):d.resolve((e[74]=new d.Map(),e[74].set("error_code",d.i64.cast([0,26])),e[74].set("stored_procedure","MEBKeyDeriver"),e[74].set("error_message",""),a=[g,e[74]],e[72]=a[0],e[73]=a[1],a))},function(a){return a=[e[72],e[73]],e[57]=a[0],e[58]=a[1],a}]):d.resolve((e[59]=new d.Map(),e[59].set("error_code",d.i64.cast([0,25])),e[59].set("stored_procedure","MEBKeyDeriver"),e[59].set("error_message",""),a=[g,e[59]],e[57]=a[0],e[58]=a[1],a))},function(a){return a=[e[57],e[58]],e[50]=a[0],e[51]=a[1],a}]):d.resolve((a=[g,e[49]],e[50]=a[0],e[51]=a[1],a))},function(c){return e[50]!==g?d.seq([function(a){return d.sp(b("LSEncryptIdentifiers"),e[43],e[42],e[36],e[50]).then(function(a){return a=a,e[56]=a[0],e[57]=a[1],a})},function(c){return e[56]!==g?d.seq([function(c){return d.i64.eq(e[43],d.i64.cast([0,1]))?(e[70]=e[44]===""?g:e[44],e[70]!==g?(c=[e[70],g],e[68]=c[0],e[69]=c[1],c):(e[71]=new d.Map(),e[71].set("error_code",d.i64.cast([0,30])),e[71].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[71].set("error_message",""),c=[g,e[71]],e[68]=c[0],e[69]=c[1],c),c=[e[68],e[69]],e[62]=c[0],e[63]=c[1],c):(c=["",g],e[62]=c[0],e[63]=c[1],c),e[62]!==g?d.seq([function(a){return d.i64.eq(e[43],d.i64.cast([0,1]))?d.seq([function(a){return d.sp(b("LSEncryptMessagePayload"),e[36],e[50],e[62]).then(function(a){return a=a,e[74]=a[0],e[75]=a[1],a})},function(a){return a=[e[74],e[75]],e[68]=a[0],e[69]=a[1],a}]):d.resolve((e[74]=new d.Map(),e[74].set("encrypted_message_payload",""),e[74].set("value_secret_ref",""),a=[e[74],g],e[68]=a[0],e[69]=a[1],a))},function(c){return e[68]!==g?d.seq([function(c){return d.sp(b("LSLoadAndEncryptProtobuf"),a[0],e[50],e[36]).then(function(a){return a=a,e[74]=a[0],e[75]=a[1],a})},function(a){return e[76]=e[56].get("act_thread_id_ocmf_partial"),e[56],e[77]=e[56].get("otid_ocmf_partial"),e[56],e[78]=e[56].get("timestamp_encrypted"),e[56],e[79]=new d.Map(),e[79].set("list_key",e[76]),e[79].set("unique_key",e[77]),e[79].set("sort_key",e[78]),e[80]=e[68].get("encrypted_message_payload"),e[68],e[81]=e[68].get("value_secret_ref"),e[68],e[82]=new d.Map(),e[82].set("value",e[80]),e[82].set("value_secret_ref",e[81]),e[83]=new d.Map(),e[83].set("list_item_id",e[79]),e[83].set("list_item",e[82]),e[83].set("action_type",e[43]),e[84]=e[36].get("server_thread_id"),e[36],e[85]=e[36].get("timestamp"),e[36],e[86]=e[36].get("otid"),e[36],e[87]=e[36].get("act_thread_id"),e[36],e[88]=new d.Map(),e[88].set("server_thread_key",e[84]),e[88].set("timestamp",e[85]),e[88].set("otid",e[86]),e[88].set("wa_thread_id",d.i64.from_string(e[87])),e[89]=e[50].get("mailbox_base_salt"),e[50],d.nop(b("LSBase64Encode.nop"),e[89]).then(function(a){return a=a,e[90]=a[0],a})},function(a){return e[91]=e[50].get("ocmf_shared_key"),e[50],d.nop(b("LSBase64Encode.nop"),e[91]).then(function(a){return a=a,e[92]=a[0],a})},function(a){return e[93]=new d.Map(),e[93].set("mailbox_root_key",e[90]==null?"":e[90]),e[93].set("ocmf_client_state_blob",e[92]==null?"":e[92]),e[94]=e[56].get("backup_id_ocmf_partial"),e[56],e[95]=e[50].get("message_payload_encryption_keys"),e[50],e[96]=e[95].get("epoch_id"),e[95],e[97]=e[50].get("message_payload_encryption_keys"),e[50],e[98]=e[97].get("encryption_version"),e[97],e[99]=new d.Map(),e[99].set("mailbox_partial_id",e[94]),e[99].set("action",e[83]),e[99].set("device_id",e[29]),e[99].set("echo_version",d.i64.cast([0,0])),e[99].set("epoch_id",e[96]),e[99].set("trace_id",g),e[99].set("encryption_version",e[98]),e[99].set("is_thread",d.i64.eq(e[42],d.i64.cast([0,2]))),e[99].set("raw_identifiers",e[88]),e[99].set("raw_tokens",e[93]),e[99].set("request_id",e[45]==null?"":e[45]),e[99].set("tam_thread_subtype",d.i64.cast([0,0])),e[99].set("is_instamadillo",!1),e[74]!==g?d.seq([function(a){return e[115]=e[74].get("supplemental_data_encrypted"),e[74],e[115]!==g?d.seq([function(a){return e[117]=e[74].get("protobuf_encrypted"),e[74],e[118]=e[74].get("backup_action"),e[74],e[119]=e[74].get("timestamp_ms"),e[74],e[120]=e[115].get("sk_ciphertext"),e[115],d.nop(b("LSBase64Encode.nop"),e[120]).then(function(a){return a=a,e[121]=a[0],a})},function(a){return e[122]=e[115].get("sk_hash"),e[115],d.nop(b("LSBase64Encode.nop"),e[122]).then(function(a){return a=a,e[123]=a[0],a})},function(a){return e[124]=e[74].get("message_tags"),e[74],e[125]=new d.Map(),e[125].set("supplementary_data_key",g),e[125].set("encrypted_protobuf",e[117]),e[125].set("key_value_backup_action",e[118]),e[125].set("protobuf_ts_ms",e[119]),e[125].set("supplemental_key_ciphertext",e[121]),e[125].set("supplemental_key_hash",e[123]),e[125].set("message_tags",e[124]),e[116]=e[125]}]):d.resolve((e[117]=e[74].get("protobuf_encrypted"),e[74],e[118]=e[74].get("backup_action"),e[74],e[119]=e[74].get("timestamp_ms"),e[74],e[120]=e[74].get("message_tags"),e[74],e[121]=new d.Map(),e[121].set("supplementary_data_key",g),e[121].set("encrypted_protobuf",e[117]),e[121].set("key_value_backup_action",e[118]),e[121].set("protobuf_ts_ms",e[119]),e[121].set("message_tags",e[120]),e[116]=e[121]))},function(a){return e[99].set("key_value_backup_payload",e[116])}]):d.resolve()},function(a){return d.resolve(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] Skip processing attachments as not enabled."))},function(a){return e[45]!==g?d.sp(b("LSAppendDataTraceAddon"),e[45],d.i64.cast([0,1463]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[100]=a[0],a})},function(a){return e[100]?e[101]=!0:e[101]=!1,e[101]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[115]=d.createArray(),g!==g?e[116]=(e[115].push(g),e[115]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[115],d.i64.cast([0,3]))):d.resolve()},function(b){return e[102]=d.toJSON(e[99]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[115]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[116]=g:e[116]=e[46],b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[115],d.i64.cast([0,1e6])),e[13]),e[116]],e[103]=b[0],e[104]=b[1],e[105]=b[2],e[106]=b[3],e[107]=b[4],e[108]=b[5],e[109]=b[6],b):(f=c.item,e[115]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[116]=g:e[116]=e[46],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[115],d.i64.cast([0,1e6])),e[13]),e[116]],e[103]=b[0],e[104]=b[1],e[105]=b[2],e[106]=b[3],e[107]=b[4],e[108]=b[5],e[109]=b[6],b)})},function(a){return e[111]=new d.Map(),e[111].set("task_id",e[103]),e[111].set("queue_name",e[104]),e[111].set("enqueue_timestamp_ms",e[105]),e[111].set("priority",e[106]),e[111].set("first_executed_timestamp_ms",e[107]),e[111].set("execution_time_ns",e[108]),e[111].set("echo_encoding_execution_time_ns",e[109]),e[112]=new d.Map(),e[112].set("task_metadata",e[111]),e[112].set("action_type",e[43]),e[112].set("content_type",e[42]),e[112].set("identifiers",e[36]),e[112].set("task_creation_source",g),e[112].set("message_payload_source",d.i64.cast([0,2])),e[113]=new d.Map(),e[113].set("payload",e[102]),e[114]=d.createArray(),e[115]=(e[114].push(e[75]),e[114]),a=[e[113],g,e[112],e[114]],e[70]=a[0],e[71]=a[1],e[72]=a[2],e[73]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[85]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[86]=g:e[86]=e[46],b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[85],d.i64.cast([0,1e6])),e[13]),e[86]],e[74]=b[0],e[75]=b[1],e[76]=b[2],e[77]=b[3],e[78]=b[4],e[79]=b[5],e[80]=b[6],b):(f=c.item,e[85]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[86]=g:e[86]=e[46],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[85],d.i64.cast([0,1e6])),e[13]),e[86]],e[74]=b[0],e[75]=b[1],e[76]=b[2],e[77]=b[3],e[78]=b[4],e[79]=b[5],e[80]=b[6],b)})},function(a){return e[82]=new d.Map(),e[82].set("task_id",e[74]),e[82].set("queue_name",e[75]),e[82].set("enqueue_timestamp_ms",e[76]),e[82].set("priority",e[77]),e[82].set("first_executed_timestamp_ms",e[78]),e[82].set("execution_time_ns",e[79]),e[82].set("echo_encoding_execution_time_ns",e[80]),e[83]=new d.Map(),e[83].set("task_metadata",e[82]),e[83].set("action_type",e[43]),e[83].set("content_type",e[42]),e[83].set("identifiers",e[36]),e[83].set("task_creation_source",g),e[83].set("message_payload_source",d.i64.cast([0,2])),e[84]=d.createArray(),a=[g,e[69],e[83],e[84]],e[70]=a[0],e[71]=a[1],e[72]=a[2],e[73]=a[3],a}])},function(a){return a=[e[70],e[71],e[72],e[73]],e[64]=a[0],e[65]=a[1],e[66]=a[2],e[67]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[79]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[80]=g:e[80]=e[46],b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[79],d.i64.cast([0,1e6])),e[13]),e[80]],e[68]=b[0],e[69]=b[1],e[70]=b[2],e[71]=b[3],e[72]=b[4],e[73]=b[5],e[74]=b[6],b):(f=c.item,e[79]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[80]=g:e[80]=e[46],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[79],d.i64.cast([0,1e6])),e[13]),e[80]],e[68]=b[0],e[69]=b[1],e[70]=b[2],e[71]=b[3],e[72]=b[4],e[73]=b[5],e[74]=b[6],b)})},function(a){return e[76]=new d.Map(),e[76].set("task_id",e[68]),e[76].set("queue_name",e[69]),e[76].set("enqueue_timestamp_ms",e[70]),e[76].set("priority",e[71]),e[76].set("first_executed_timestamp_ms",e[72]),e[76].set("execution_time_ns",e[73]),e[76].set("echo_encoding_execution_time_ns",e[74]),e[77]=new d.Map(),e[77].set("task_metadata",e[76]),e[77].set("action_type",e[43]),e[77].set("content_type",e[42]),e[77].set("identifiers",e[36]),e[77].set("task_creation_source",g),e[77].set("message_payload_source",d.i64.cast([0,2])),e[78]=d.createArray(),a=[g,e[63],e[77],e[78]],e[64]=a[0],e[65]=a[1],e[66]=a[2],e[67]=a[3],a}])},function(a){return a=[e[64],e[65],e[66],e[67]],e[58]=a[0],e[59]=a[1],e[60]=a[2],e[61]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[73]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[74]=g:e[74]=e[46],b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[73],d.i64.cast([0,1e6])),e[13]),e[74]],e[62]=b[0],e[63]=b[1],e[64]=b[2],e[65]=b[3],e[66]=b[4],e[67]=b[5],e[68]=b[6],b):(f=c.item,e[73]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[74]=g:e[74]=e[46],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[73],d.i64.cast([0,1e6])),e[13]),e[74]],e[62]=b[0],e[63]=b[1],e[64]=b[2],e[65]=b[3],e[66]=b[4],e[67]=b[5],e[68]=b[6],b)})},function(a){return e[70]=new d.Map(),e[70].set("task_id",e[62]),e[70].set("queue_name",e[63]),e[70].set("enqueue_timestamp_ms",e[64]),e[70].set("priority",e[65]),e[70].set("first_executed_timestamp_ms",e[66]),e[70].set("execution_time_ns",e[67]),e[70].set("echo_encoding_execution_time_ns",e[68]),e[71]=new d.Map(),e[71].set("task_metadata",e[70]),e[71].set("action_type",e[43]),e[71].set("content_type",e[42]),e[71].set("identifiers",e[36]),e[71].set("task_creation_source",g),e[71].set("message_payload_source",d.i64.cast([0,2])),e[72]=d.createArray(),a=[g,e[57],e[71],e[72]],e[58]=a[0],e[59]=a[1],e[60]=a[2],e[61]=a[3],a}])},function(a){return a=[e[58],e[59],e[60],e[61]],e[52]=a[0],e[53]=a[1],e[54]=a[2],e[55]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[67]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[68]=g:e[68]=e[46],b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[67],d.i64.cast([0,1e6])),e[13]),e[68]],e[56]=b[0],e[57]=b[1],e[58]=b[2],e[59]=b[3],e[60]=b[4],e[61]=b[5],e[62]=b[6],b):(f=c.item,e[67]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[68]=g:e[68]=e[46],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[67],d.i64.cast([0,1e6])),e[13]),e[68]],e[56]=b[0],e[57]=b[1],e[58]=b[2],e[59]=b[3],e[60]=b[4],e[61]=b[5],e[62]=b[6],b)})},function(a){return e[64]=new d.Map(),e[64].set("task_id",e[56]),e[64].set("queue_name",e[57]),e[64].set("enqueue_timestamp_ms",e[58]),e[64].set("priority",e[59]),e[64].set("first_executed_timestamp_ms",e[60]),e[64].set("execution_time_ns",e[61]),e[64].set("echo_encoding_execution_time_ns",e[62]),e[65]=new d.Map(),e[65].set("task_metadata",e[64]),e[65].set("action_type",e[43]),e[65].set("content_type",e[42]),e[65].set("identifiers",e[36]),e[65].set("task_creation_source",g),e[65].set("message_payload_source",d.i64.cast([0,2])),e[66]=d.createArray(),a=[g,e[51],e[65],e[66]],e[52]=a[0],e[53]=a[1],e[54]=a[2],e[55]=a[3],a}])},function(a){return a=[e[52],e[53],e[54],e[55]],e[37]=a[0],e[38]=a[1],e[39]=a[2],e[40]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[60]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[61]=g:e[61]=e[46],b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[60],d.i64.cast([0,1e6])),e[13]),e[61]],e[48]=b[0],e[49]=b[1],e[50]=b[2],e[51]=b[3],e[52]=b[4],e[53]=b[5],e[54]=b[6],b):(f=c.item,e[60]=d.i64.of_float(Date.now()),d.i64.eq(e[46],d.i64.cast([0,0]))||d.i64.eq(e[46],g)?e[61]=g:e[61]=e[46],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[60],d.i64.cast([0,1e6])),e[13]),e[61]],e[48]=b[0],e[49]=b[1],e[50]=b[2],e[51]=b[3],e[52]=b[4],e[53]=b[5],e[54]=b[6],b)})},function(a){return e[56]=new d.Map(),e[56].set("task_id",e[48]),e[56].set("queue_name",e[49]),e[56].set("enqueue_timestamp_ms",e[50]),e[56].set("priority",e[51]),e[56].set("first_executed_timestamp_ms",e[52]),e[56].set("execution_time_ns",e[53]),e[56].set("echo_encoding_execution_time_ns",e[54]),e[57]=new d.Map(),e[57].set("task_metadata",e[56]),e[57].set("action_type",e[43]),e[57].set("content_type",e[42]),e[57].set("identifiers",e[36]),e[57].set("task_creation_source",g),e[57].set("message_payload_source",d.i64.cast([0,2])),e[58]=new d.Map(),e[58].set("error_code",e[47]),e[58].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[58].set("error_message",""),e[59]=d.createArray(),a=[g,e[58],e[57],e[59]],e[37]=a[0],e[38]=a[1],e[39]=a[2],e[40]=a[3],a}])},function(a){return a=[e[37],e[38],e[39],e[40]],e[30]=a[0],e[31]=a[1],e[32]=a[2],e[33]=a[3],a}]))})},function(a){return a=[e[30],e[31],e[32],e[33]],e[22]=a[0],e[23]=a[1],e[24]=a[2],e[25]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[42]=d.i64.of_float(Date.now()),b=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[42],d.i64.cast([0,1e6])),e[13]),g],e[30]=b[0],e[31]=b[1],e[32]=b[2],e[33]=b[3],e[34]=b[4],e[35]=b[5],e[36]=b[6],b):(f=c.item,e[42]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[42],d.i64.cast([0,1e6])),e[13]),g],e[30]=b[0],e[31]=b[1],e[32]=b[2],e[33]=b[3],e[34]=b[4],e[35]=b[5],e[36]=b[6],b)})},function(a){return e[38]=new d.Map(),e[38].set("task_id",e[30]),e[38].set("queue_name",e[31]),e[38].set("enqueue_timestamp_ms",e[32]),e[38].set("priority",e[33]),e[38].set("first_executed_timestamp_ms",e[34]),e[38].set("execution_time_ns",e[35]),e[38].set("echo_encoding_execution_time_ns",e[36]),e[39]=new d.Map(),e[39].set("task_metadata",e[38]),e[39].set("action_type",g),e[39].set("content_type",g),e[39].set("identifiers",g),e[39].set("task_creation_source",g),e[39].set("message_payload_source",d.i64.cast([0,2])),e[40]=new d.Map(),e[40].set("error_code",d.i64.cast([0,24])),e[40].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[40].set("error_message",""),e[41]=d.createArray(),a=[g,e[40],e[39],e[41]],e[22]=a[0],e[23]=a[1],e[24]=a[2],e[25]=a[3],a}])},function(a){return a=[e[22],e[23],e[24],e[25]],e[14]=a[0],e[15]=a[1],e[16]=a[2],e[17]=a[3],a}]))})},function(a){return a=[e[14],e[15],e[16],e[17]],e[2]=a[0],e[3]=a[1],e[4]=a[2],e[5]=a[3],a}]):d.seq([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[26]=d.i64.of_float(Date.now()),f=[a[0],g,g,g,g,d.i64.sub(d.i64.mul(e[26],d.i64.cast([0,1e6])),e[13]),g],e[14]=f[0],e[15]=f[1],e[16]=f[2],e[17]=f[3],e[18]=f[4],e[19]=f[5],e[20]=f[6],f):(c=b.item,e[26]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,c.priority,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[26],d.i64.cast([0,1e6])),e[13]),g],e[14]=f[0],e[15]=f[1],e[16]=f[2],e[17]=f[3],e[18]=f[4],e[19]=f[5],e[20]=f[6],f)})},function(a){return e[22]=new d.Map(),e[22].set("task_id",e[14]),e[22].set("queue_name",e[15]),e[22].set("enqueue_timestamp_ms",e[16]),e[22].set("priority",e[17]),e[22].set("first_executed_timestamp_ms",e[18]),e[22].set("execution_time_ns",e[19]),e[22].set("echo_encoding_execution_time_ns",e[20]),e[23]=new d.Map(),e[23].set("task_metadata",e[22]),e[23].set("action_type",g),e[23].set("content_type",g),e[23].set("identifiers",g),e[23].set("task_creation_source",g),e[23].set("message_payload_source",d.i64.cast([0,2])),e[24]=new d.Map(),e[24].set("error_code",d.i64.cast([0,4])),e[24].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[24].set("error_message",""),e[25]=d.createArray(),a=[g,e[24],e[23],e[25]],e[2]=a[0],e[3]=a[1],e[4]=a[2],e[5]=a[3],a}])},function(a){return e[6]=d.i64.of_float(Date.now()),e[8]="Finishing execution. Execution time: ",e[9]=d.i64.to_string(d.i64.sub(e[6],e[0])),e[11]=" ms",e[7]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][serializeBackupPayloadV2] ",e[7],e[8],e[7],e[9],e[7],e[11]].join("")),e[10]=",",e[12]=d.createArray(),g!==g?e[14]=(e[12].push(g),e[12]):0,d.nop(b("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[e[8],e[10],e[9],e[10],e[11]].join(""),e[12],d.i64.cast([0,4]))},function(a){return a=[e[2],e[3],e[4],e[5]],f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],a}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.fe(c.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]),function(a){var b=a.update;a.item;return b({backupStatus:c.i64.cast([0,2])})})},function(e){return c.sp(b("LSSerializeBackupPayloadV2"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],a})},function(a){return d[6]=c.i64.of_int32(d[5].length),c.i64.gt(d[6],c.i64.cast([0,0]))?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[5],c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(a){return d[7]=d[21]}]):c.resolve(d[7]=f)},function(a){return d[2]?d[8]=!1:d[8]=!0,d[8]?(d[3]?d[21]=!1:d[21]=!0,d[21]?(a=[f,f,d[7],d[4]],d[22]=a[0],d[23]=a[1],d[24]=a[2],d[25]=a[3],a):(a=[f,d[3],d[7],d[4]],d[22]=a[0],d[23]=a[1],d[24]=a[2],d[25]=a[3],a),a=[d[22],d[23],d[24],d[25]],d[9]=a[0],d[10]=a[1],d[11]=a[2],d[12]=a[3],a):(d[21]=d[2].get("payload"),d[2],a=[d[21],f,d[7],d[4]],d[9]=a[0],d[10]=a[1],d[11]=a[2],d[12]=a[3],a),d[21]=new c.Map(),d[22]=d[21].set("success",d[9]),d[23]=d[21].set("failure",d[10]),d[24]=d[21].set("protobuf_failure",d[11]),d[25]=d[21].set("context",d[12]),d[26]=c.toJSON(d[21]),d[13]=d[26],d[14]=c.i64.of_float(Date.now()),d[16]="Finishing execution. Execution time: ",d[17]=c.i64.to_string(c.i64.sub(d[14],d[0])),d[19]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",d[15],d[16],d[15],d[17],d[15],d[19]].join("")),d[18]=",",d[20]=c.createArray(),f!==f?d[21]=(d[20].push(f),d[20]):0,c.nop(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[d[16],d[18],d[17],d[18],d[19]].join(""),d[20],c.i64.cast([0,4]))},function(a){return a=[d[13],c.i64.cast([0,50026])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSLoadProtobufBackupSerializedPayloadData",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSEncryptIdentifiers","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobuf","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadProtobufBackupSerializedPayloadData] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[23]=c.i64.mul(d[1],c.i64.cast([0,1e6])),c.db.table(2).fetch([[[a[0]]]]).next().then(function(b,e){var g=b.done;b=b.value;return g?(d[24]=c.i64.of_float(Date.now()),g=[a[0],f,f,f,f,c.i64.sub(c.i64.mul(d[24],c.i64.cast([0,1e6])),d[23]),f],d[2]=g[0],d[3]=g[1],d[4]=g[2],d[5]=g[3],d[6]=g[4],d[7]=g[5],d[8]=g[6],g):(e=b.item,d[24]=c.i64.of_float(Date.now()),g=[a[0],e.queueName,e.enqueueTimestampMs,e.priority,e.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[24],c.i64.cast([0,1e6])),d[23]),f],d[2]=g[0],d[3]=g[1],d[4]=g[2],d[5]=g[3],d[6]=g[4],d[7]=g[5],d[8]=g[6],g)})},function(e){return d[10]=new c.Map(),d[10].set("task_id",d[2]),d[10].set("queue_name",d[3]),d[10].set("enqueue_timestamp_ms",d[4]),d[10].set("priority",d[5]),d[10].set("first_executed_timestamp_ms",d[6]),d[10].set("execution_time_ns",d[7]),d[10].set("echo_encoding_execution_time_ns",d[8]),d[11]=new c.Map(),d[11].set("task_metadata",d[10]),d[11].set("action_type",f),d[11].set("content_type",f),d[11].set("identifiers",f),d[11].set("task_creation_source",f),d[11].set("message_payload_source",c.i64.cast([0,2])),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,h){var i=e.done;e=e.value;return i?(d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,1])),d[24].set("stored_procedure","LSEncryptedBackupsLoadProtobufBackupSerializedPayloadDataStoredProcedure"),d[24].set("error_message",""),i=[f,d[24],d[11]],d[12]=i[0],d[13]=i[1],d[14]=i[2],i):(h=e.item,c.seq([function(a){return d[32]=h.mailboxRootKeyBlob,d[33]=h.deviceId,d[31]=h.backupTenancy,d[30]=h.encryptionVersion,c.i64.neq(f,f)?c.resolve(d[24]=f):c.seq([function(a){return d[34]=c.createArray(),c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[44]=(d[34].push(c.i64.cast([0,0])),d[34]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[44]=(d[34].push(c.i64.cast([0,2])),d[34]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[44]=(d[34].push(c.i64.cast([0,3])),d[34]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[44]=(d[34].push(c.i64.cast([0,4])),d[34]):0,d[39]=c.createArray(),d[40]=c.i64.of_int32(d[34].length),c.i64.gt(d[40],c.i64.cast([0,0]))?c.loopAsync(d[40],function(a){return d[44]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[34],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=(d[39].push(d[45]),d[39])}])}):c.resolve()},function(a){return c.seq([function(a){return d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[47]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[39],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[44].push(c.i64.to_string(d[48])),d[44])}])}):c.resolve()},function(a){return d[46]=d[44].join(","),d[41]=d[46]}])},function(a){return d[39].some(function(a){return c.i64.eq(d[30],a)})?d[42]=d[30]:d[42]=f,c.i64.neq(d[42],f)?d[43]=d[42]:d[43]=f,d[24]=d[43]}])},function(e){return c.i64.neq(d[24],f)?d[25]=d[24]:d[25]=c.i64.cast([0,0]),c.i64.neq(d[31],f)?d[26]=d[31]:d[26]=c.i64.cast([0,1]),c.i64.neq(d[33],f)?c.seq([function(e){return c.ftr(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(j,k){var e=j.done;j=j.value;return e?(d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,5])),d[38].set("stored_procedure","LSEncryptedBackupsLoadProtobufBackupSerializedPayloadDataStoredProcedure"),d[38].set("error_message",""),e=[f,d[38],d[11]],d[34]=e[0],d[35]=e[1],d[36]=e[2],e):(k=j.item,c.seq([function(b){return d[56]=k.actThreadId,d[38]=new c.Map(),d[38].set("backup_id",c.i64.to_string(h.backupId)),d[38].set("act_thread_id",d[56]),d[38].set("server_thread_id",d[56]),d[38].set("timestamp",c.i64.to_string(k.messageTimestampMs)),d[38].set("otid",k.toplevelOfflineThreadingId),c.db.table(2).fetch([[[a[0]]]]).next().then(function(e,g){var b=e.done;e=e.value;return b?(d[57]=c.i64.of_float(Date.now()),b=[a[0],f,f,f,f,c.i64.sub(c.i64.mul(d[57],c.i64.cast([0,1e6])),d[23]),f],d[39]=b[0],d[40]=b[1],d[41]=b[2],d[42]=b[3],d[43]=b[4],d[44]=b[5],d[45]=b[6],b):(g=e.item,d[57]=c.i64.of_float(Date.now()),b=[a[0],g.queueName,g.enqueueTimestampMs,g.priority,g.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[57],c.i64.cast([0,1e6])),d[23]),f],d[39]=b[0],d[40]=b[1],d[41]=b[2],d[42]=b[3],d[43]=b[4],d[44]=b[5],d[45]=b[6],b)})},function(a){return d[47]=new c.Map(),d[47].set("task_id",d[39]),d[47].set("queue_name",d[40]),d[47].set("enqueue_timestamp_ms",d[41]),d[47].set("priority",d[42]),d[47].set("first_executed_timestamp_ms",d[43]),d[47].set("execution_time_ns",d[44]),d[47].set("echo_encoding_execution_time_ns",d[45]),d[48]=new c.Map(),d[48].set("task_metadata",d[47]),d[48].set("action_type",c.i64.cast([0,1])),d[48].set("content_type",c.i64.cast([0,1])),d[48].set("identifiers",d[38]),d[48].set("task_creation_source",f),d[48].set("message_payload_source",c.i64.cast([0,2])),c.sp(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[49]!==f?c.seq([function(a){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?c.seq([function(a){return d[60]=d[38].get("act_thread_id"),d[38],d[61]=c.createArray(),d[66]=(d[61].push(c.i64.cast([0,32])),d[61]),c.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",d[60]].join("")).then(function(a){return a=a,d[62]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[62],f,d[32],d[61]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[63]?d[64]=!1:d[64]=!0,d[64]?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[66]=c.createArray(),f!==f?d[67]=(d[66].push(f),d[66]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[66],c.i64.cast([0,3]))},function(a){return d[65]=f}]):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[63],c.i64.cast([0,0])).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[65]=d[66]}])},function(a){return d[57]=d[65]}]):c.seq([function(a){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,2]))?c.seq([function(a){return d[61]=d[38].get("otid"),d[38],d[62]=c.createArray(),d[67]=(d[62].push(c.i64.cast([0,32])),d[62]),c.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",d[61]].join("")).then(function(a){return a=a,d[63]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[63],f,d[32],d[62]).then(function(a){return a=a,d[64]=a[0],a})},function(a){return d[64]?d[65]=!1:d[65]=!0,d[65]?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[67]=c.createArray(),f!==f?d[68]=(d[67].push(f),d[67]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[67],c.i64.cast([0,3]))},function(a){return d[66]=f}]):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[64],c.i64.cast([0,0])).then(function(a){return a=a,d[67]=a[0],d[68]=a[1],a})},function(a){return d[66]=d[67]}])},function(a){return d[60]=d[66]}]):c.resolve(d[60]=f)},function(a){return d[57]=d[60]}])},function(a){return c.blobs.neq(d[57],f)?c.seq([function(a){return d[60]=d[49].get("epoch_keys"),d[49],d[61]=d[60].get("epoch_anon_id"),d[60],d[62]=d[60].get("epoch_root_key"),d[60],d[63]=d[38].get("act_thread_id"),d[38],d[64]=c.createArray(),d[75]=(d[64].push(c.i64.cast([0,32])),d[64]),c.i64.ge(d[25],c.i64.cast([0,3]))?c.resolve(d[65]=f):c.seq([function(a){return c.nop(b("LSGetBlobFromString.nop"),d[63]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[65]=d[75]}])},function(a){return c.i64.ge(d[25],c.i64.cast([0,4]))?(d[75]="_",d[66]=["message_key_in_epoch",d[75],c.blobs.to_string(d[61]),d[75],"cipher_version",d[75],c.i64.to_string(d[25]),d[75],"thread",d[75],d[63]==null?"":d[63]].join("")):(c.i64.ge(d[25],c.i64.cast([0,3]))?(d[76]="_",d[75]=["message_key_in_epoch",d[76],c.blobs.to_string(d[61]),d[76],"cipher_version",d[76],c.i64.to_string(d[25]),d[76],"thread",d[76],d[63]==null?"":d[63]].join("")):(c.i64.ge(d[25],c.i64.cast([0,2]))?(d[77]="_",d[76]=["message_key_in_epoch",d[77],c.blobs.to_string(d[61]),d[77],"cipher_version",d[77],c.i64.to_string(d[25])].join("")):d[76]=["message_key_in_epoch","_",c.blobs.to_string(d[61])].join(""),d[75]=d[76]),d[66]=d[75]),c.nop(b("LSGetBlobFromString.nop"),d[66]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[67],d[65],d[62],d[64]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return d[68]?d[69]=!1:d[69]=!0,d[69]?c.resolve(d[70]=f):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[68],c.i64.cast([0,0])).then(function(a){return a=a,d[75]=a[0],d[76]=a[1],a})},function(a){return d[70]=d[75]}])},function(a){return c.ftr(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,c.blob("MA=="))}).next().then(function(e,h){var a=e.done;e=e.value;return a?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),d[75]=c.createArray(),f!==f?d[76]=(d[75].push(f),d[75]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get mailbox_root_key_v2: epoch 0 is not available.",d[75],c.i64.cast([0,3]))},function(a){return d[71]=f}]):(h=e.item,c.seq([function(a){return d[75]=c.createArray(),d[83]=(d[75].push(c.i64.cast([0,32])),d[75]),c.nop(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),f,d[32],d[75]).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]!==f?c.seq([function(a){return d[83]=c.i64.of_int32(d[76].length),c.i64.ge(d[83],c.i64.cast([0,1]))?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[76],c.i64.cast([0,0])).then(function(a){return a=a,d[85]=a[0],d[86]=a[1],a})},function(a){return d[84]=d[85]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[85]=c.createArray(),f!==f?d[86]=(d[85].push(f),d[85]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[85],c.i64.cast([0,3]))},function(a){return d[84]=f}])},function(a){return d[77]=d[84]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[83]=c.createArray(),f!==f?d[84]=(d[83].push(f),d[83]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[83],c.i64.cast([0,3]))},function(a){return d[77]=f}])},function(a){return c.blobs.neq(d[77],f)?d[78]=!0:d[78]=!1,d[78]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[79]=c.createArray(),d[83]=(d[79].push(c.i64.cast([0,32])),d[79]),c.nop(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),d[77],h.epochRootKeyBlob,d[79]).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]!==f?c.seq([function(a){return d[83]=c.i64.of_int32(d[80].length),c.i64.ge(d[83],c.i64.cast([0,1]))?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[80],c.i64.cast([0,0])).then(function(a){return a=a,d[85]=a[0],d[86]=a[1],a})},function(a){return d[84]=d[85]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[85]=c.createArray(),f!==f?d[86]=(d[85].push(f),d[85]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[85],c.i64.cast([0,3]))},function(a){return d[84]=f}])},function(a){return d[81]=d[84]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[83]=c.createArray(),f!==f?d[84]=(d[83].push(f),d[83]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[83],c.i64.cast([0,3]))},function(a){return d[81]=f}])},function(a){return c.blobs.neq(d[81],f)?d[82]=!0:d[82]=!1,d[82]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[71]=d[81]}]))})},function(a){return c.blobs.neq(d[70],f)?c.seq([function(a){return c.blobs.neq(d[71],f)?c.seq([function(a){return d[81]=c.createArray(),d[85]=(d[81].push(c.i64.cast([0,32])),d[81]),c.nop(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),f,d[71],d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]!==f?c.seq([function(a){return d[85]=c.i64.of_int32(d[82].length),c.i64.ge(d[85],c.i64.cast([0,1]))?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[82],c.i64.cast([0,0])).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return d[86]=d[87]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[87]=c.createArray(),f!==f?d[88]=(d[87].push(f),d[87]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[87],c.i64.cast([0,3]))},function(a){return d[86]=f}])},function(a){return d[83]=d[86]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[85]=c.createArray(),f!==f?d[86]=(d[85].push(f),d[85]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[85],c.i64.cast([0,3]))},function(a){return d[83]=f}])},function(a){return c.blobs.neq(d[83],f)?d[84]=!0:d[84]=!1,d[84]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[75]=d[83]}]):c.resolve(d[75]=f)},function(a){return d[76]=d[60].get("epoch_root_key"),d[60],d[77]=d[60].get("epoch_anon_id"),d[60],d[78]=d[60].get("epoch_id"),d[60],d[79]=new c.Map(),d[79].set("payload_key",d[70]),d[79].set("payload_fallback_key",d[75]),d[79].set("encryption_version",d[25]),d[79].set("epoch_root_key",d[76]),d[79].set("epoch_anon_id",d[77]),d[79].set("epoch_id",d[78]),d[80]=new c.Map(),d[80].set("ope_key",d[57]),d[80].set("message_payload_encryption_keys",d[79]),d[80].set("ocmf_shared_key",h.ocmfClientStateBlob),d[80].set("mailbox_base_salt",d[32]),d[80].set("mailbox_root_key_v2",d[71]),a=[d[80],f],d[73]=a[0],d[74]=a[1],a}]):c.resolve((d[75]=new c.Map(),d[75].set("error_code",c.i64.cast([0,26])),d[75].set("stored_procedure","MEBKeyDeriver"),d[75].set("error_message",""),a=[f,d[75]],d[73]=a[0],d[74]=a[1],a))},function(a){return a=[d[73],d[74]],d[58]=a[0],d[59]=a[1],a}]):c.resolve((d[60]=new c.Map(),d[60].set("error_code",c.i64.cast([0,25])),d[60].set("stored_procedure","MEBKeyDeriver"),d[60].set("error_message",""),a=[f,d[60]],d[58]=a[0],d[59]=a[1],a))},function(a){return a=[d[58],d[59]],d[51]=a[0],d[52]=a[1],a}]):c.resolve((a=[f,d[50]],d[51]=a[0],d[52]=a[1],a))},function(e){return d[51]!==f?c.seq([function(a){return c.sp(b("LSEncryptIdentifiers"),c.i64.cast([0,1]),c.i64.cast([0,1]),d[38],d[51]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=d[51].get("message_payload_encryption_keys"),d[51],d[60]=d[59].get("encryption_version"),d[59],d[61]=d[59].get("epoch_anon_id"),d[59],d[62]=d[59].get("epoch_root_key"),d[59],d[63]=d[38].get("act_thread_id"),d[38],d[64]=d[59].get("payload_key"),d[59],d[65]=d[38].get("backup_id"),d[38],d[66]=d[59].get("payload_fallback_key"),d[59],d[67]=c.createArray(),d[99]=(d[67].push(c.i64.cast([0,6])),d[67]),c.nop(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[68]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[68],f,d[61],d[67]).then(function(a){return a=a,d[69]=a[0],a})},function(a){return d[69]?d[70]=!1:d[70]=!0,d[70]?c.resolve(d[71]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[69],c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[99]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[71]=d[101]==null?"":d[101]}])},function(a){return d[72]=c.createArray(),d[99]=(d[72].push(c.i64.cast([0,6])),d[72]),c.nop(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[73]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[73],f,d[62],d[72]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]?d[75]=!1:d[75]=!0,d[75]?c.resolve(d[76]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[74],c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[99]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[76]=d[101]==null?"":d[101]}])},function(a){return d[77]=c.createArray(),d[99]=(d[77].push(c.i64.cast([0,6])),d[77]),c.nop(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[78]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[78],f,d[64],d[77]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]?d[80]=!1:d[80]=!0,d[80]?c.resolve(d[81]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[79],c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[99]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[81]=d[101]==null?"":d[101]}])},function(a){return c.nop(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.nop(b("LSGetBlobFromString.nop"),[d[82]==null?"":d[82],d[63]].join("")).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[84]=c.createArray(),d[99]=(d[84].push(c.i64.cast([0,6])),d[84]),c.nop(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[85]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[85],f,d[83],d[84]).then(function(a){return a=a,d[86]=a[0],a})},function(a){return d[86]?d[87]=!1:d[87]=!0,d[87]?c.resolve(d[88]=""):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[86],c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[99]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[88]=d[101]==null?"":d[101]}])},function(a){return d[89]=":",d[98]=[d[71],d[89],d[76],d[89],d[81],d[89],d[88]].join(""),c.blobs.neq(d[62],f)?c.seq([function(a){return d[99]=c.createArray(),d[105]=(d[99].push(c.i64.cast([0,18])),d[99]),c.nop(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),f,d[62],d[99]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[100]!==f?c.seq([function(a){return d[105]=c.i64.of_int32(d[100].length),c.i64.ge(d[105],c.i64.cast([0,1]))?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[100],c.i64.cast([0,0])).then(function(a){return a=a,d[107]=a[0],d[108]=a[1],a})},function(a){return d[106]=d[107]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[107]=c.createArray(),f!==f?d[108]=(d[107].push(f),d[107]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[107],c.i64.cast([0,3]))},function(a){return d[106]=f}])},function(a){return d[101]=d[106]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[105]=c.createArray(),f!==f?d[106]=(d[105].push(f),d[105]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[105],c.i64.cast([0,3]))},function(a){return d[101]=f}])},function(a){return c.blobs.neq(d[101],f)?d[102]=!0:d[102]=!1,d[102]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nop(b("LSBase64Encode.nop"),d[101]).then(function(a){return a=a,d[103]=a[0],a})},function(a){return d[103]!==f?d[104]=d[103]:d[104]="encodingfailed",d[90]=d[104]}]):c.resolve(d[90]="null")},function(a){return c.nop(b("LSBase64Encode.nop"),d[61]).then(function(a){return a=a,d[91]=a[0],a})},function(a){return d[97]=d[91]==null?"":d[91],c.blobs.neq(d[66],f)?c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][MEBSerializationUtils] Including fallback encrypted epoch key in value_secret_ref."),c.nop(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[99]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[66],c.blob("ZmFsbGJhY2tfZW5jcnlwdGVkX2Vwb2NoX2tleQ=="),d[99]==null?"":d[99]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[100]!==f?d[101]=d[100]:d[101]="",d[102]=new c.Map(),d[102].set("encryption_version",d[60]),d[102].set("epoch_anon_id",d[97]),d[102].set("message_encryption_values",d[98]),d[102].set("fallback_encrypted_epoch_key",d[101]),d[102].set("root_key_fingerprint",d[90]),d[102].set("backup_id",d[65]),d[92]=d[102]}]):c.resolve((d[99]=new c.Map(),d[99].set("encryption_version",d[60]),d[99].set("epoch_anon_id",d[97]),d[99].set("message_encryption_values",d[98]),d[99].set("root_key_fingerprint",d[90]),d[99].set("backup_id",d[65]),d[92]=d[99]))},function(e){return d[93]=c.toJSON(d[92]),d[57]!==f?c.seq([function(e){return c.sp(b("LSLoadAndEncryptProtobuf"),a[0],d[51],d[38]).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return d[99]!==f?(d[104]=new c.Map(),d[104].set("protobuf_backup_payload",d[99]),d[104].set("encrypted_identifiers",d[57]),d[104].set("device_id",d[33]),d[104].set("identifiers",d[38]),d[104].set("encryption_keys",d[51]),d[104].set("content_type",c.i64.cast([0,1])),d[104].set("action_type",c.i64.cast([0,1])),d[104].set("value_secret_ref",d[93]),d[104].set("attachment_backup_payload",k.attachmentPayload),a=[d[104],f,d[48]],d[101]=a[0],d[102]=a[1],d[103]=a[2],a):(a=[f,d[100],d[48]],d[101]=a[0],d[102]=a[1],d[103]=a[2],a),a=[d[101],d[102],d[103]],d[94]=a[0],d[95]=a[1],d[96]=a[2],a}]):c.resolve((e=[f,d[58],d[48]],d[94]=e[0],d[95]=e[1],d[96]=e[2],e))},function(a){return a=[d[94],d[95],d[96]],d[53]=a[0],d[54]=a[1],d[55]=a[2],a}]):c.resolve((e=[f,d[52],d[48]],d[53]=e[0],d[54]=e[1],d[55]=e[2],e))},function(a){return a=[d[53],d[54],d[55]],d[34]=a[0],d[35]=a[1],d[36]=a[2],a}]))})},function(a){return a=[d[34],d[35],d[36]],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}]):c.resolve((d[34]=new c.Map(),d[34].set("error_code",c.i64.cast([0,24])),d[34].set("stored_procedure","LSEncryptedBackupsLoadProtobufBackupSerializedPayloadDataStoredProcedure"),d[34].set("error_message",""),e=[f,d[34],d[11]],d[27]=e[0],d[28]=e[1],d[29]=e[2],e))},function(a){return a=[d[27],d[28],d[29]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return d[16]=c.i64.of_float(Date.now()),d[18]="Finishing execution. Execution time: ",d[19]=c.i64.to_string(c.i64.sub(d[16],d[0])),d[21]=" ms",d[17]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadProtobufBackupSerializedPayloadData] ",d[17],d[18],d[17],d[19],d[17],d[21]].join("")),d[20]=",",d[22]=c.createArray(),f!==f?d[24]=(d[22].push(f),d[22]):0,c.nop(b("LSLogMebClientEvent.nop"),"loadProtobufBackupSerializedPayloadData",[d[18],d[20],d[19],d[20],d[21]].join(""),d[22],c.i64.cast([0,4]))},function(a){return a=[d[12],d[13],d[14]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",["LSBase64Encode.nop","LSLoadProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUploadProtobufOnly] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.sp(b("LSLoadProtobufBackupSerializedPayloadData"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],a})},function(a){return d[2]!==f?c.seq([function(a){return d[16]=d[2].get("encrypted_identifiers"),d[2],d[17]=d[2].get("identifiers"),d[2],d[18]=d[2].get("encryption_keys"),d[2],d[19]=d[2].get("protobuf_backup_payload"),d[2],d[20]=d[16].get("act_thread_id_ocmf_partial"),d[16],d[21]=d[16].get("otid_ocmf_partial"),d[16],d[22]=d[16].get("timestamp_encrypted"),d[16],d[23]=new c.Map(),d[23].set("list_key",d[20]),d[23].set("unique_key",d[21]),d[23].set("sort_key",d[22]),d[24]=d[2].get("value_secret_ref"),d[2],d[25]=new c.Map(),d[25].set("value",""),d[25].set("value_secret_ref",d[24]),d[26]=d[2].get("action_type"),d[2],d[27]=new c.Map(),d[27].set("list_item_id",d[23]),d[27].set("list_item",d[25]),d[27].set("action_type",d[26]),d[28]=d[17].get("server_thread_id"),d[17],d[29]=d[17].get("timestamp"),d[17],d[30]=d[17].get("otid"),d[17],d[31]=d[17].get("act_thread_id"),d[17],d[32]=new c.Map(),d[32].set("server_thread_key",d[28]),d[32].set("timestamp",d[29]),d[32].set("otid",d[30]),d[32].set("wa_thread_id",c.i64.from_string(d[31])),d[33]=d[18].get("mailbox_base_salt"),d[18],c.nop(b("LSBase64Encode.nop"),d[33]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[35]=d[18].get("ocmf_shared_key"),d[18],c.nop(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[37]=new c.Map(),d[37].set("mailbox_root_key",d[34]==null?"":d[34]),d[37].set("ocmf_client_state_blob",d[36]==null?"":d[36]),d[38]=d[16].get("backup_id_ocmf_partial"),d[16],d[39]=d[2].get("device_id"),d[2],d[40]=d[18].get("message_payload_encryption_keys"),d[18],d[41]=d[40].get("epoch_id"),d[40],d[42]=d[18].get("message_payload_encryption_keys"),d[18],d[43]=d[42].get("encryption_version"),d[42],d[44]=d[2].get("content_type"),d[2],d[45]=new c.Map(),d[45].set("mailbox_partial_id",d[38]),d[45].set("action",d[27]),d[45].set("device_id",d[39]),d[45].set("echo_version",c.i64.cast([0,0])),d[45].set("epoch_id",d[41]),d[45].set("trace_id",f),d[45].set("encryption_version",d[43]),d[45].set("is_thread",c.i64.eq(d[44],c.i64.cast([0,2]))),d[45].set("raw_identifiers",d[32]),d[45].set("raw_tokens",d[37]),d[45].set("request_id",""),d[45].set("is_instamadillo",!0),d[46]=d[19].get("supplemental_data_encrypted"),d[19],d[46]!==f?c.seq([function(a){return d[50]=d[19].get("protobuf_encrypted"),d[19],d[51]=d[19].get("backup_action"),d[19],d[52]=d[19].get("timestamp_ms"),d[19],d[53]=d[46].get("sk_ciphertext"),d[46],c.nop(b("LSBase64Encode.nop"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[55]=d[46].get("sk_hash"),d[46],c.nop(b("LSBase64Encode.nop"),d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[57]=d[19].get("message_tags"),d[19],d[58]=new c.Map(),d[58].set("supplementary_data_key",f),d[58].set("encrypted_protobuf",d[50]),d[58].set("key_value_backup_action",d[51]),d[58].set("protobuf_ts_ms",d[52]),d[58].set("supplemental_key_ciphertext",d[54]),d[58].set("supplemental_key_hash",d[56]),d[58].set("message_tags",d[57]),d[47]=d[58]}]):c.resolve((d[50]=d[19].get("protobuf_encrypted"),d[19],d[51]=d[19].get("backup_action"),d[19],d[52]=d[19].get("timestamp_ms"),d[19],d[53]=d[19].get("message_tags"),d[19],d[54]=new c.Map(),d[54].set("supplementary_data_key",f),d[54].set("encrypted_protobuf",d[50]),d[54].set("key_value_backup_action",d[51]),d[54].set("protobuf_ts_ms",d[52]),d[54].set("message_tags",d[53]),d[47]=d[54]))},function(a){return d[45].set("key_value_backup_payload",d[47]),d[48]=d[2].get("attachment_backup_payload"),d[2],d[48]!==f?d[45].set("attachment_backup_payload",d[48]):0,d[49]=c.toJSON(d[45]),a=[d[49],f,d[4]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a}]):c.resolve((d[3]?d[16]=!1:d[16]=!0,d[16]?(a=[f,f,d[4]],d[17]=a[0],d[18]=a[1],d[19]=a[2],a):(a=[f,d[3],d[4]],d[17]=a[0],d[18]=a[1],d[19]=a[2],a),a=[d[17],d[18],d[19]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a))},function(a){return d[16]=new c.Map(),d[17]=d[16].set("success",d[5]),d[18]=d[16].set("failure",d[6]),d[19]=d[16].set("context",d[7]),d[20]=c.toJSON(d[16]),d[8]=d[20],d[9]=c.i64.of_float(Date.now()),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadProtobufOnly] ",d[10],d[11],d[10],d[12],d[10],d[14]].join("")),d[13]=",",d[15]=c.createArray(),f!==f?d[16]=(d[15].push(f),d[15]):0,c.nop(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadProtobufOnly",[d[11],d[13],d[12],d[13],d[14]].join(""),d[15],c.i64.cast([0,4]))},function(a){return a=[d[8],c.i64.cast([0,50042])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSTaskSerializerMuteThreadV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("TaskSerializerMuteThreadV2: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,b.seq([function(a){return c[6]=f.threadKey,b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?(c[7]=b.createArray(),c[8]=(c[7].push("TaskSerializerMuteThreadV2: Thread not found"),c[7]),c[9]=(c[7].push(c[6]),c[7]),c[10]=b.toJSON(c[7]),function(a){b.logger(a).mustfix(a)}(c[10]),a=[e,e],c[3]=a[0],c[4]=a[1],a):(f=d.item,b.seq([function(a){return b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?c[7]=b.i64.cast([0,1]):(f=d.item,c[12]=f.syncGroup,b.i64.neq(c[12],e)?c[11]=c[12]:c[11]=b.i64.cast([0,1]),c[7]=c[11])})},function(a){return c[9]=new b.Map(),c[9].set("thread_key",c[6]),c[9].set("mailbox_type",b.i64.cast([0,0])),c[9].set("mute_expire_time_ms",f.muteExpireTimeMs),c[9].set("sync_group",c[7]),c[10]=b.toJSON(c[9]),a=[c[10],b.i64.cast([0,144])],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSTaskSerializerRemoveThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("TaskSerializerRemoveThreadV2: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,c[5]=f.removeType,b.i64.neq(c[5],e)?(c[6]=new b.Map(),c[6].set("thread_key",f.threadKey),c[6].set("remove_type",c[5]),c[6].set("sync_group",f.syncGroup==null?b.i64.cast([0,1]):f.syncGroup),c[7]=b.toJSON(c[6]),g=[c[7],b.i64.cast([0,146])],c[3]=g[0],c[4]=g[1],g):(d=[e,e],c[3]=d[0],c[4]=d[1],d),f=[c[3],c[4]],c[0]=f[0],c[1]=f[1],f)})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSTaskSerializerSendMessageV2",["LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(31).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,b.seq([function(d){return c[9]=f.offlineThreadingId,c[10]=f.messageId,c[17]=f.threadAttributionSource,c[7]=f.platformRef,c[8]=f.platformToken,c[6]=f.replySourceId,c[11]=f.replySourceType,c[16]=f.sendType,c[12]=f.initiatingSource,c[13]=f.skipUrlPreviewGen,c[14]=f.textHasLinks,c[15]=f.multitabEnv,b.db.table(12).fetch([[[c[9]]],"optimistic"]).next().then(function(f,h){var d=f.done;f=f.value;return d?(c[18]=b.createArray(),c[19]=(c[18].push("OTID not found"),c[18]),c[20]=(c[18].push(c[9]),c[18]),c[21]=b.toJSON(c[18]),function(a){b.logger(a).mustfix(a)}(c[21]),d=[e,e],c[3]=d[0],c[4]=d[1],d):(h=f.item,b.seq([function(d){return c[24]=h.text,c[21]=h.threadKey,c[25]=h.messageId,c[23]=h.stickerId,c[27]=h.mentionOffsets,c[28]=h.mentionLengths,c[22]=h.mentionIds,c[29]=h.mentionTypes,c[32]=h.replyType,c[30]=h.isForwarded,c[26]=h.forwardScore,c[31]=h.hotEmojiSize,b.db.table(9).fetch([[[c[21]]]]).next().then(function(f,i){var d=f.done;f=f.value;return d?(c[33]=b.createArray(),c[34]=(c[33].push("thread not found"),c[33]),c[35]=(c[33].push(c[21]),c[33]),c[36]=b.toJSON(c[33]),function(a){b.logger(a).mustfix(a)}(c[36]),d=[e,e],c[18]=d[0],c[19]=d[1],d):(i=f.item,b.seq([function(d){return c[38]=i.threadName,c[33]=i.threadType,b.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?c[34]=!1:(f=e.item,b.seq([function(d){return b.islc(b.db.table(2).fetch([[[f.queueName]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(e,f){var d=e.done;e=e.value;return d?c[39]=!1:(f=e.item,c[39]=b.i64.eq(f.taskId,a[0]))})},function(a){return c[34]=c[39]}]))})},function(a){return b.i64.eq(i.authorityLevel,b.i64.cast([0,20]))&&(b.i64.eq(c[33],b.i64.cast([0,2]))||b.i64.eq(c[33],b.i64.cast([0,5]))||b.i64.eq(c[33],b.i64.cast([0,26])))&&c[34]?b.seq([function(a){return c[42]=c[16]==null?b.i64.cast([0,1]):c[16],b.db.table(9).fetch([[[c[21]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?c[39]=b.i64.cast([0,1]):(f=d.item,c[54]=f.syncGroup,b.i64.neq(c[54],e)?c[53]=c[54]:c[53]=b.i64.cast([0,1]),c[39]=c[53])})},function(a){return c[41]=new b.Map(),c[41].set("thread_id",c[21]),c[41].set("otid",c[9]),c[41].set("source",c[17]==null?b.i64.cast([0,0]):c[17]),c[41].set("send_type",b.i64.cast([0,1])),c[41].set("sync_group",c[39]),b.i64.eq(c[42],b.i64.cast([0,1]))?b.resolve(c[41].set("text",c[24])):b.i64.eq(c[42],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[23],e)?(c[41].set("sticker_id",c[23]),c[41].set("send_type",c[42])):0):b.i64.eq(c[42],b.i64.cast([0,7]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[53]=a[0],c[54]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[53]=a[0],c[54]=a[1],a)})},function(a){return c[53]!==e?b.i64.neq(c[54],e)?(c[41].set("url",c[53]),c[41].set("attribution_app_id",c[54]),c[41].set("send_type",c[42])):0:0}]):b.i64.eq(c[42],b.i64.cast([0,3]))?b.seq([function(a){return c[41].set("text",c[24]),c[53]=b.createArray(),c[54]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[55]=a.offlineAttachmentId,c[56]=(c[53].push(b.i64.from_string(a.attachmentFbid)),c[53]),c[55]!==e?c[56]=(c[54].push(c[55]),c[54]):0})},function(a){return c[41].set("attachment_fbids",c[53]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[54]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,9]))?b.seq([function(a){return c[41].set("text",c[24]),c[53]=b.createArray(),c[54]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[55]=a.offlineAttachmentId,c[56]=(c[53].push(b.i64.from_string(a.attachmentFbid)),c[53]),c[55]!==e?c[56]=(c[54].push(c[55]),c[54]):0})},function(a){return c[41].set("attachment_fbids",c[53]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[54]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,10]))?b.seq([function(a){return c[41].set("text",c[24]),c[53]=b.createArray(),c[54]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[55]=a.offlineAttachmentId,c[56]=(c[53].push(b.i64.from_string(a.attachmentFbid)),c[53]),c[55]!==e?c[56]=(c[54].push(c[55]),c[54]):0})},function(a){return c[41].set("attachment_fbids",c[53]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[54]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,4]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[53]=e:(d=b.item,c[53]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[55]=e:(d=b.item,c[55]=d.actionUrl)})},function(a){return c[53]!==e?(c[41].set("text",c[24]),c[55]!==e?c[41].set("url",c[55]):0,c[41].set("forwarded_share_id",c[53]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,5]))?b.resolve(c[10]!==e?(c[41].set("forwarded_msg_id",c[10]),c[41].set("send_type",c[42]),b.i64.neq(c[26],e)?c[41].set("forward_score",c[26]):0,c[41].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[42],b.i64.cast([0,6]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[53]=a[0],c[54]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[53]=a[0],c[54]=a[1],a)})},function(a){return c[53]!==e?(c[41].set("url",c[53]),c[41].set("text",c[24]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,11]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[53]=a[0],c[54]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[53]=a[0],c[54]=a[1],a)})},function(a){return c[53]!==e?(c[41].set("url",c[53]),c[41].set("send_type",c[42])):0}]):b.resolve(0)},function(a){return c[49]=c[6]===""?e:c[6],c[49]!==e?b.i64.neq(c[11],e)?(c[53]=new b.Map(),c[53].set("reply_source_id",c[49]),c[53].set("reply_source_type",c[11]),c[53].set("reply_type",c[32]==null?b.i64.cast([0,0]):c[32]),c[41].set("reply_metadata",c[53])):0:0,c[50]=c[22]===""?e:c[22],c[50]!==e?(c[53]=c[27]===""?e:c[27],c[53]!==e?(c[54]=c[28]===""?e:c[28],c[54]!==e?(c[55]=new b.Map(),c[55].set("mention_ids",c[50]),c[55].set("mention_offsets",c[53]),c[55].set("mention_lengths",c[54]),c[55].set("mention_types",c[29]===""?e:c[29]),c[41].set("mention_data",c[55])):0):0):0,c[30]!==e?c[41].set("is_forwarded",c[30]):0,c[51]=c[7]===""?e:c[7],c[51]!==e?c[41].set("platform_ref",c[51]):0,c[52]=c[8]===""?e:c[8],c[52]!==e?c[41].set("platform_token",c[52]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[42],a)})?b.i64.neq(c[31],e)?c[41].set("hot_emoji_size",c[31]):0:0,b.i64.neq(c[12],e)?c[41].set("initiating_source",c[12]):0,c[13]!==e?c[41].set("skip_url_preview_gen",c[13]):0,b.resolve()},function(a){return c[14]!==e?c[41].set("text_has_links",c[14]):0,c[15]!==e?c[41].set("multitab_env",c[15]):0,c[43]=b.createArray(),b.fe(b.db.table(14).fetch([[[c[21]]]]),function(a){a=a.item;return c[53]=(c[43].push(a.contactId),c[43])})},function(a){return c[44]=new b.Map(),c[44].set("participants",c[43]),c[44].set("send_payload",c[41]),c[38]!==e?c[44].set("thread_name",c[38]):0,b.db.table(312).fetch([[[c[21]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[45]=e:(d=b.item,c[45]=d.metadata)})},function(a){return c[44].set("thread_metadata",c[45]),b.fe(b.db.table(9).fetch([[[i.threadKey]]]),function(a){var b=a.update;a.item;return b({otidOfFirstMessage:h.offlineThreadingId})})},function(a){return c[45]===e||!1?(b.i64.eq(c[33],b.i64.cast([0,5]))||b.i64.eq(c[33],b.i64.cast([0,26]))?(function(a){b.logger(a).mustfix(a)}("For Marketplace & community chat subthreads, thread metadata cannot be null"),a=[e,e],c[53]=a[0],c[54]=a[1],a):(c[55]=b.toJSON(c[44]),a=[c[55],b.i64.cast([0,130])],c[53]=a[0],c[54]=a[1],a),a=[c[53],c[54]],c[47]=a[0],c[48]=a[1],a):(b.i64.eq(c[33],b.i64.cast([0,5]))?(c[55]=b.toJSON(c[44]),a=[c[55],b.i64.cast([0,645])],c[53]=a[0],c[54]=a[1],a):(b.i64.eq(c[33],b.i64.cast([0,26]))?(c[57]=b.toJSON(c[44]),a=[c[57],b.i64.cast([0,696])],c[55]=a[0],c[56]=a[1],a):(c[57]=b.toJSON(c[44]),a=[c[57],b.i64.cast([0,645])],c[55]=a[0],c[56]=a[1],a),a=[c[55],c[56]],c[53]=a[0],c[54]=a[1],a),a=[c[53],c[54]],c[47]=a[0],c[48]=a[1],a),a=[c[47],c[48]],c[36]=a[0],c[37]=a[1],a}]):b.seq([function(a){return c[42]=c[16]==null?b.i64.cast([0,1]):c[16],b.db.table(9).fetch([[[c[21]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?c[39]=b.i64.cast([0,1]):(f=d.item,c[49]=f.syncGroup,b.i64.neq(c[49],e)?c[48]=c[49]:c[48]=b.i64.cast([0,1]),c[39]=c[48])})},function(a){return c[41]=new b.Map(),c[41].set("thread_id",c[21]),c[41].set("otid",c[9]),c[41].set("source",c[17]==null?b.i64.cast([0,0]):c[17]),c[41].set("send_type",b.i64.cast([0,1])),c[41].set("sync_group",c[39]),b.i64.eq(c[42],b.i64.cast([0,1]))?b.resolve(c[41].set("text",c[24])):b.i64.eq(c[42],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[23],e)?(c[41].set("sticker_id",c[23]),c[41].set("send_type",c[42])):0):b.i64.eq(c[42],b.i64.cast([0,7]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[48]=a[0],c[49]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[48]=a[0],c[49]=a[1],a)})},function(a){return c[48]!==e?b.i64.neq(c[49],e)?(c[41].set("url",c[48]),c[41].set("attribution_app_id",c[49]),c[41].set("send_type",c[42])):0:0}]):b.i64.eq(c[42],b.i64.cast([0,3]))?b.seq([function(a){return c[41].set("text",c[24]),c[48]=b.createArray(),c[49]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[50]=a.offlineAttachmentId,c[51]=(c[48].push(b.i64.from_string(a.attachmentFbid)),c[48]),c[50]!==e?c[51]=(c[49].push(c[50]),c[49]):0})},function(a){return c[41].set("attachment_fbids",c[48]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[49]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,9]))?b.seq([function(a){return c[41].set("text",c[24]),c[48]=b.createArray(),c[49]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[50]=a.offlineAttachmentId,c[51]=(c[48].push(b.i64.from_string(a.attachmentFbid)),c[48]),c[50]!==e?c[51]=(c[49].push(c[50]),c[49]):0})},function(a){return c[41].set("attachment_fbids",c[48]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[49]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,10]))?b.seq([function(a){return c[41].set("text",c[24]),c[48]=b.createArray(),c[49]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[50]=a.offlineAttachmentId,c[51]=(c[48].push(b.i64.from_string(a.attachmentFbid)),c[48]),c[50]!==e?c[51]=(c[49].push(c[50]),c[49]):0})},function(a){return c[41].set("attachment_fbids",c[48]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[49]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,4]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[48]=e:(d=b.item,c[48]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[50]=e:(d=b.item,c[50]=d.actionUrl)})},function(a){return c[48]!==e?(c[41].set("text",c[24]),c[50]!==e?c[41].set("url",c[50]):0,c[41].set("forwarded_share_id",c[48]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,5]))?b.resolve(c[10]!==e?(c[41].set("forwarded_msg_id",c[10]),c[41].set("send_type",c[42]),b.i64.neq(c[26],e)?c[41].set("forward_score",c[26]):0,c[41].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[42],b.i64.cast([0,6]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[48]=a[0],c[49]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[48]=a[0],c[49]=a[1],a)})},function(a){return c[48]!==e?(c[41].set("url",c[48]),c[41].set("text",c[24]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,11]))?b.seq([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[48]=a[0],c[49]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[48]=a[0],c[49]=a[1],a)})},function(a){return c[48]!==e?(c[41].set("url",c[48]),c[41].set("send_type",c[42])):0}]):b.resolve(0)},function(a){return c[44]=c[6]===""?e:c[6],c[44]!==e?b.i64.neq(c[11],e)?(c[48]=new b.Map(),c[48].set("reply_source_id",c[44]),c[48].set("reply_source_type",c[11]),c[48].set("reply_type",c[32]==null?b.i64.cast([0,0]):c[32]),c[41].set("reply_metadata",c[48])):0:0,c[45]=c[22]===""?e:c[22],c[45]!==e?(c[48]=c[27]===""?e:c[27],c[48]!==e?(c[49]=c[28]===""?e:c[28],c[49]!==e?(c[50]=new b.Map(),c[50].set("mention_ids",c[45]),c[50].set("mention_offsets",c[48]),c[50].set("mention_lengths",c[49]),c[50].set("mention_types",c[29]===""?e:c[29]),c[41].set("mention_data",c[50])):0):0):0,c[30]!==e?c[41].set("is_forwarded",c[30]):0,c[46]=c[7]===""?e:c[7],c[46]!==e?c[41].set("platform_ref",c[46]):0,c[47]=c[8]===""?e:c[8],c[47]!==e?c[41].set("platform_token",c[47]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[42],a)})?b.i64.neq(c[31],e)?c[41].set("hot_emoji_size",c[31]):0:0,b.i64.neq(c[12],e)?c[41].set("initiating_source",c[12]):0,c[13]!==e?c[41].set("skip_url_preview_gen",c[13]):0,b.resolve()},function(a){return c[14]!==e?c[41].set("text_has_links",c[14]):0,c[15]!==e?c[41].set("multitab_env",c[15]):0,c[43]=b.toJSON(c[41]),a=[c[43],b.i64.cast([0,46])],c[36]=a[0],c[37]=a[1],a}])},function(a){return a=[c[36],c[37]],c[18]=a[0],c[19]=a[1],a}]))})},function(a){return a=[c[18],c[19]],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSTaskSerializerUpdateThreadName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("taskSerializerUpdateThreadName: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,b.seq([function(a){return c[6]=f.threadKey,b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?(c[7]=b.createArray(),c[8]=(c[7].push("taskSerializerUpdateThreadName: Thread not found"),c[7]),c[9]=(c[7].push(c[6]),c[7]),c[10]=b.toJSON(c[7]),function(a){b.logger(a).mustfix(a)}(c[10]),a=[e,e],c[3]=a[0],c[4]=a[1],a):(f=d.item,b.seq([function(a){return b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?c[7]=b.i64.cast([0,1]):(f=d.item,c[12]=f.syncGroup,b.i64.neq(c[12],e)?c[11]=c[12]:c[11]=b.i64.cast([0,1]),c[7]=c[11])})},function(a){return c[9]=new b.Map(),c[9].set("thread_key",c[6]),c[9].set("thread_name",f.threadName==null?"":f.threadName),c[9].set("sync_group",c[7]),c[10]=b.toJSON(c[9]),a=[c[10],b.i64.cast([0,32])],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSSerializeTask",["LSTaskSerializerAcsIssueNextSync","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return a[1]==="46"?c.seq([function(e){return c.sp(b("LSTaskSerializerSendMessageV2"),a[0]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return a=[d[6],c.i64.to_string(d[7]),f],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}]):c.seq([function(e){return a[1]==="144"?c.seq([function(e){return c.sp(b("LSTaskSerializerMuteThreadV2"),a[0]).then(function(a){return a=a,d[9]=a[0],d[10]=a[1],a})},function(a){return a=[d[9],c.i64.to_string(d[10]),f],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}]):c.seq([function(e){return a[1]==="146"?c.seq([function(e){return c.sp(b("LSTaskSerializerRemoveThread"),a[0]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return a=[d[12],c.i64.to_string(d[13]),f],d[9]=a[0],d[10]=a[1],d[11]=a[2],a}]):c.seq([function(e){return a[1]==="32"?c.seq([function(e){return c.sp(b("LSTaskSerializerUpdateThreadName"),a[0]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return a=[d[15],c.i64.to_string(d[16]),f],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):c.seq([function(e){return a[1]==="362"?c.seq([function(e){return c.sp(b("LSTaskSerializerAcsIssueNextSync"),a[0]).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return a=[d[18],c.i64.to_string(d[19]),f],d[15]=a[0],d[16]=a[1],d[17]=a[2],a}]):c.seq([function(e){return a[1]==="50015"?c.seq([function(e){return c.sp(b("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),a[0]).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(a){return a=[d[21],c.i64.to_string(d[22]),f],d[18]=a[0],d[19]=a[1],d[20]=a[2],a}]):c.seq([function(e){return a[1]==="319"?c.seq([function(e){return c.sp(b("LSTaskSerializerEncryptedBackupAction"),a[0]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return a=[d[24],c.i64.to_string(d[25]),f],d[21]=a[0],d[22]=a[1],d[23]=a[2],a}]):c.seq([function(e){return a[1]==="50026"?c.seq([function(e){return c.sp(b("LSTaskSerializerEncryptedBackupsUpload"),a[0]).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],a})},function(a){return a=[d[27],c.i64.to_string(d[28]),f],d[24]=a[0],d[25]=a[1],d[26]=a[2],a}]):c.seq([function(e){return a[1]==="50042"?c.seq([function(e){return c.sp(b("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),a[0]).then(function(a){return a=a,d[30]=a[0],d[31]=a[1],a})},function(a){return a=[d[30],c.i64.to_string(d[31]),f],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}]):c.seq([function(e){return a[1]==="700"?c.seq([function(e){return c.sp(b("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),a[0]).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(a){return a=[d[33],c.i64.to_string(d[34]),f],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}]):c.seq([function(e){return a[1]==="705"?c.seq([function(e){return c.sp(b("LSTaskSerializerE2eeMessageIntegrityCheckV2"),a[0]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return a=[d[36],c.i64.to_string(d[37]),f],d[33]=a[0],d[34]=a[1],d[35]=a[2],a}]):c.seq([function(e){return a[1]==="50043"?c.seq([function(e){return c.sp(b("LSTaskSerializerEncryptedBackupsLoopingUpload"),a[0]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return a=[d[39],c.i64.to_string(d[40]),f],d[36]=a[0],d[37]=a[1],d[38]=a[2],a}]):c.resolve((e=[a[2],a[1],f],d[36]=e[0],d[37]=e[1],d[38]=e[2],e))},function(a){return a=[d[36],d[37],d[38]],d[33]=a[0],d[34]=a[1],d[35]=a[2],a}])},function(a){return a=[d[33],d[34],d[35]],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}])},function(a){return a=[d[30],d[31],d[32]],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}])},function(a){return a=[d[27],d[28],d[29]],d[24]=a[0],d[25]=a[1],d[26]=a[2],a}])},function(a){return a=[d[24],d[25],d[26]],d[21]=a[0],d[22]=a[1],d[23]=a[2],a}])},function(a){return a=[d[21],d[22],d[23]],d[18]=a[0],d[19]=a[1],d[20]=a[2],a}])},function(a){return a=[d[18],d[19],d[20]],d[15]=a[0],d[16]=a[1],d[17]=a[2],a}])},function(a){return a=[d[15],d[16],d[17]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}])},function(a){return a=[d[12],d[13],d[14]],d[9]=a[0],d[10]=a[1],d[11]=a[2],a}])},function(a){return a=[d[9],d[10],d[11]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}])},function(a){return a=[d[6],d[7],d[8]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(e){return a[3]?c.resolve((d[1]==="60009"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60009"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[6]=e[0],d[7]=e[1],d[8]=e[2],e):(d[1]==="60006"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60006"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[9]=e[0],d[10]=e[1],d[11]=e[2],e):(d[1]==="60008"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60008"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[12]=e[0],d[13]=e[1],d[14]=e[2],e):(d[1]==="765"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","765"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[15]=e[0],d[16]=e[1],d[17]=e[2],e):(d[1]==="761"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","761"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[18]=e[0],d[19]=e[1],d[20]=e[2],e):(d[1]==="632"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","632"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[21]=e[0],d[22]=e[1],d[23]=e[2],e):(d[1]==="384"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","384"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[24]=e[0],d[25]=e[1],d[26]=e[2],e):(d[1]==="384"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","384"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[f,f,f],d[27]=e[0],d[28]=e[1],d[29]=e[2],e):(e=[d[0],d[1],d[2]],d[27]=e[0],d[28]=e[1],d[29]=e[2],e),e=[d[27],d[28],d[29]],d[24]=e[0],d[25]=e[1],d[26]=e[2],e),e=[d[24],d[25],d[26]],d[21]=e[0],d[22]=e[1],d[23]=e[2],e),e=[d[21],d[22],d[23]],d[18]=e[0],d[19]=e[1],d[20]=e[2],e),e=[d[18],d[19],d[20]],d[15]=e[0],d[16]=e[1],d[17]=e[2],e),e=[d[15],d[16],d[17]],d[12]=e[0],d[13]=e[1],d[14]=e[2],e),e=[d[12],d[13],d[14]],d[9]=e[0],d[10]=e[1],d[11]=e[2],e),e=[d[9],d[10],d[11]],d[6]=e[0],d[7]=e[1],d[8]=e[2],e),e=[d[6],d[7],d[8]],d[3]=e[0],d[4]=e[1],d[5]=e[2],e)):c.seq([function(e){return c.sp(b("LSTaskSerializerUnauthenticatedTask"),a[0],d[1],d[0]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return a=[d[6],c.i64.to_string(d[7]),f],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}])},function(a){return a=[d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSBeginHandlingPendingTasksForQueue",["LSSerializeTask","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1];d.n;var e=[],f=[],g;return d.seq([function(h){return d.seq([function(b){return d.ftr(d.db.table(3).fetch([[[a[0]]]]),function(b){return d.i64.neq(b.epochId,g)&&b.taskQueueName===a[0]}).next().then(function(a,b){b=a.done;a=a.value;return b?e[0]=!1:(a.item,e[0]=!0)})},function(f){return e[2]=new d.Map(),e[2].set("queue_name",a[0]),e[2].set("next_sync_ms",g),e[2].set("work_item_type",d.i64.cast([0,4])),e[2].set("network_payload",g),e[2].set("http_url_override",g),e[2].set("skip_realtime_gateway",!1),e[3]=e[2],e[0]?d.resolve():d.seq([function(b){return d.islc(d.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",d.i64.cast([-1,4294967295]),d.i64.cast([0,0]),d.i64.cast([-1,4294967295]),g,g],e[4]=c[0],e[5]=c[1],e[6]=c[2],e[7]=c[3],e[8]=c[4],e[9]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],e[4]=c[0],e[5]=c[1],e[6]=c[2],e[7]=c[3],e[8]=c[4],e[9]=c[5],c)})},function(b){return d.db.table(3).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[11]=d.i64.cast([0,0]):(b=a.item,e[11]=b.lastSyncRequestTimestampMs)})},function(f){return e[13]=d.i64.of_float(Date.now()),e[15]=d.i64.sub(e[5],e[13]),d.i64.le(e[15],d.i64.cast([0,0]))?(d.i64.eq(e[7],d.i64.cast([0,0]))||a[1]?e[16]=d.i64.cast([0,0]):(d.i64.gt(e[7],d.i64.cast([0,7]))?e[19]=d.i64.sub(e[7],d.i64.cast([0,7])):e[19]=e[7],e[20]=d.i64.sub(e[19],d.i64.cast([0,1])),e[21]=d.i64.mul(d.i64.lsl_(d.i64.cast([0,1]),d.i64.to_int32(d.i64.lt(e[20],d.i64.cast([0,7]))?e[20]:d.i64.cast([0,7]))),d.i64.cast([0,500])),e[16]=d.i64.lt(e[21],d.i64.cast([0,3e4]))?e[21]:d.i64.cast([0,3e4])),e[17]=d.i64.of_float(Date.now()),e[18]=d.i64.sub(d.i64.add(e[11],e[16]),e[17]),e[14]=d.i64.gt(e[18],d.i64.cast([0,0]))?e[18]:d.i64.cast([0,0])):e[14]=e[15],d.i64.neq(e[14],d.i64.cast([0,0]))?d.resolve((e[16]=new d.Map(),e[16].set("queue_name",a[0]),e[16].set("next_sync_ms",e[14]),e[16].set("work_item_type",d.i64.cast([0,3])),e[16].set("network_payload",g),e[16].set("http_url_override",g),e[16].set("skip_realtime_gateway",!1),e[3]=e[16])):d.seq([function(a){return d.i64.neq(e[6],d.i64.cast([0,0]))||e[8]==="16"||e[8]==="4"?d.resolve((a=[e[4],g,d.i64.cast([0,2]),g,g,!1],e[16]=a[0],e[17]=a[1],e[18]=a[2],e[19]=a[3],e[20]=a[4],e[21]=a[5],a)):d.seq([function(a){return e[23]=d.createArray(),e[24]=!0,d.islc(d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",d.i64.cast([-1,4294967295]),d.i64.cast([0,0]),d.i64.cast([-1,4294967295]),g,g],e[25]=c[0],e[26]=c[1],e[27]=c[2],e[28]=c[3],e[29]=c[4],e[30]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],e[25]=c[0],e[26]=c[1],e[27]=c[2],e[28]=c[3],e[29]=c[4],e[30]=c[5],c)})},function(a){return d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[32]=!0:(b=a.item,d.seq([function(a){return d.db.table(306).fetch([[[b.taskId]]]).next().then(function(b,c){var a=b.done;b=b.value;return a?e[41]=!0:(c=b.item,e[41]=c.requiresAuthentication)})},function(a){return e[32]=e[41]}]))})},function(a){return d.fe(d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]),function(a){var f=a.item;return d.seq([function(a){return e[41]=f.taskId,e[42]=f.context,e[44]=f.failureCount,e[43]=f.timeoutTimestampMs,d.i64.eq(f.firstExecutedTimestampMs,d.i64.cast([0,0]))?(e[45]=d.i64.of_float(Date.now()),d.fe(d.db.table(2).fetch([[[e[41]]]]),function(a){var b=a.update;a.item;return b({firstExecutedTimestampMs:e[45]})})):d.resolve()},function(a){return d.seq([function(a){return d.db.table(306).fetch([[[e[41]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[45]=!0:(b=a.item,e[45]=b.requiresAuthentication)})},function(a){return e[24]=f.httpUrlOverride===e[30]&&e[45]===e[32]&&e[24],e[24]?d.seq([function(a){return e[42]===g?d.seq([function(a){return d.fe(d.db.table(2).fetch([[[e[41]]]]),function(a){return a["delete"]()})},function(a){return e[47]=g}]):d.seq([function(a){return d.i64.neq(e[43],g)?(e[54]=d.i64.of_float(Date.now()),e[52]=d.i64.ge(e[54],e[43])):e[52]=!1,e[52]?d.seq([function(a){return d.fe(d.db.table(2).fetch([[[e[41]]]]),function(a){return a["delete"]()})},function(a){return e[53]=g}]):d.seq([function(a){return d.sp(b("LSSerializeTask"),e[41],e[42],f.taskValue,e[32]).then(function(a){return a=a,e[54]=a[0],e[55]=a[1],e[56]=a[2],a})},function(a){return e[54]!==g?(e[58]=new d.Map(),e[58].set("label",e[55]),e[58].set("payload",e[54]),e[58].set("queue_name",f.queueName),e[58].set("task_id",e[41]),e[58].set("failure_count",d.i64.eq(e[44],d.i64.cast([0,0]))?g:e[44]),e[57]=e[58]):e[57]=g,e[53]=e[57]}])},function(a){return e[47]=e[53]}])},function(a){return e[47]?e[48]=!1:e[48]=!0,e[48]?0:e[52]=(e[23].push(e[47]),e[23]),e[49]=d.i64.of_int32(e[23].length),c("gkx")("6280")?e[50]=d.i64.cast([0,50]):e[50]=d.i64.cast([0,5]),e[42]!==g?e[51]=["90","130","153"].includes(e[42]):e[51]=!1,e[24]=!(d.i64.ge(e[49],e[50])||e[51])}]):d.resolve()}])}])})},function(a){return e[34]=d.i64.of_int32(e[23].length),d.i64.eq(e[34],d.i64.cast([0,0]))?d.resolve((a=[e[4],g,d.i64.cast([0,4]),g,g,!1],e[35]=a[0],e[36]=a[1],e[37]=a[2],e[38]=a[3],e[39]=a[4],e[40]=a[5],a)):d.seq([function(a){return e[41]=d.i64.of_float(Date.now()),e[42]=d.i64.random(),e[52]=d.i64.and_(d.i64.or_(d.i64.lsl_(e[41],d.i64.to_int32(d.i64.cast([0,22]))),d.i64.and_(e[42],d.i64.cast([0,4194303]))),d.i64.cast([2147483647,4294967295])),d.db.table(3).fetch([[[e[4],d.i64.cast([-1,4294967295])]]]).next().then(function(a,b){b=a.done;a=a.value;return b?(e[53]=d.i64.of_float(Date.now()),d.db.table(3).add({syncDatabaseId:d.i64.cast([-1,4294967295]),taskQueueName:e[4],failureCount:d.i64.cast([0,0]),lastSentTimestampMs:d.i64.cast([0,0]),lastSyncRequestTimestampMs:e[53],epochId:e[52]})):(a.item,e[53]=d.i64.of_float(Date.now()),d.fe(d.db.table(3).fetch([[[e[4],d.i64.cast([-1,4294967295])]]]),function(a){var b=a.update;a.item;return b({epochId:e[52],lastSyncRequestTimestampMs:e[53]})}))})},function(a){return d.islc(d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",d.i64.cast([-1,4294967295]),d.i64.cast([0,0]),d.i64.cast([-1,4294967295]),g,g],e[44]=c[0],e[45]=c[1],e[46]=c[2],e[47]=c[3],e[48]=c[4],e[49]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],e[44]=c[0],e[45]=c[1],e[46]=c[2],e[47]=c[3],e[48]=c[4],e[49]=c[5],c)})},function(a){return e[51]=new d.Map(),e[51].set("tasks",e[23]),e[51].set("epoch_id",e[52]),a=[e[4],g,d.i64.cast([0,1]),e[51],e[49],!(e[49]===g)||d.i64.gt(e[47],d.i64.cast([0,7]))],e[35]=a[0],e[36]=a[1],e[37]=a[2],e[38]=a[3],e[39]=a[4],e[40]=a[5],a}])},function(a){return a=[e[35],e[36],e[37],e[38],e[39],e[40]],e[16]=a[0],e[17]=a[1],e[18]=a[2],e[19]=a[3],e[20]=a[4],e[21]=a[5],a}])},function(a){return e[22]=new d.Map(),e[22].set("queue_name",e[16]),e[22].set("next_sync_ms",e[17]),e[22].set("work_item_type",e[18]),e[22].set("network_payload",e[19]),e[22].set("http_url_override",e[20]),e[22].set("skip_realtime_gateway",e[21]),e[3]=e[22]}])}])},function(a){return f[0]=e[3]}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSBeginHandlingSyncForSyncGroup",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(1).fetch([[[a[0]]]]).next().then(function(a,d){var f=a.done;a=a.value;return f?c[0]=e:(d=a.item,c[9]=new b.Map(),c[9].set("group_id",d.groupId),c[9].set("current_cursor",d.currentCursor),c[9].set("sync_status",d.syncStatus),c[9].set("sync_params",d.syncParams),c[9].set("send_sync_params",d.sendSyncParams),c[9].set("min_time_to_sync_timestamp_ms",d.minTimeToSyncTimestampMs),c[9].set("can_ignore_timestamp",d.canIgnoreTimestamp),c[9].set("sync_channel",d.syncChannel),c[9].set("last_sync_request_timestamp_ms",d.lastSyncRequestTimestampMs),c[0]=c[9])})},function(d){return c[0]?c[2]=!1:c[2]=!0,c[2]?b.resolve((d=[a[0],e,b.i64.cast([0,4]),e,!1],c[3]=d[0],c[4]=d[1],c[5]=d[2],c[6]=d[3],c[7]=d[4],d)):b.seq([function(a){return c[9]=c[0].get("group_id"),c[0],b.ftr(b.db.table(3).fetch(),function(a){return b.i64.neq(a.epochId,e)&&b.i64.eq(a.syncDatabaseId,c[9])}).next().then(function(a,b){b=a.done;a=a.value;return b?c[10]=!1:(a.item,c[10]=!0)})},function(d){return c[10]?b.resolve((c[17]=c[0].get("group_id"),c[0],d=[c[17],e,b.i64.cast([0,4]),e,!1],c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=d[3],c[16]=d[4],d)):b.seq([function(d){return c[17]=b.i64.of_float(Date.now()),c[18]=c[0].get("min_time_to_sync_timestamp_ms"),c[0],c[19]=c[0].get("last_sync_request_timestamp_ms"),c[0],c[20]=c[0].get("can_ignore_timestamp"),c[0],c[20]&&a[1]||b.i64.ge(c[17],c[18])?b.seq([function(d){return a[1]?b.resolve(c[28]=b.i64.cast([0,0])):b.seq([function(a){return c[29]=c[0].get("group_id"),c[0],b.db.table(3).fetch([[["",c[29]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[30]=b.i64.cast([0,0]):(d=a.item,c[30]=d.failureCount)})},function(a){return c[32]=b.i64.mul(b.i64.sub(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.lt(b.i64.cast([0,15]),c[30])?b.i64.cast([0,15]):c[30])),b.i64.cast([0,1])),b.i64.cast([0,500])),c[33]=b.i64.sub(b.i64.add(c[19]==null?b.i64.cast([0,0]):c[19],b.i64.lt(c[32],b.i64.cast([0,3e4]))?c[32]:b.i64.cast([0,3e4])),c[17]),c[28]=b.i64.gt(c[33],b.i64.cast([0,0]))?c[33]:b.i64.cast([0,0])}])},function(a){return c[21]=c[28]}]):b.resolve(c[21]=b.i64.sub(c[18],c[17]))},function(a){return c[22]=c[0].get("group_id"),c[0],b.i64.gt(c[21],b.i64.cast([0,0]))?b.seq([function(a){return c[28]=b.i64.of_float(Date.now()),b.fe(b.ftr(b.db.table(3).fetch(),function(a){return b.i64.eq(a.syncDatabaseId,c[22])}),function(a){var b=a.update;a.item;return b({lastDelayedRequestTimestampMs:c[28]})})},function(a){return a=[c[22],c[21],b.i64.cast([0,3]),e,!1],c[23]=a[0],c[24]=a[1],c[25]=a[2],c[26]=a[3],c[27]=a[4],a}]):b.seq([function(a){return c[28]=b.i64.of_float(Date.now()),b.fe(b.db.table(1).fetch([[[c[22]]]]),function(a){var b=a.update;a.item;return b({lastSyncRequestTimestampMs:c[28]})})},function(a){return c[29]=b.i64.of_float(Date.now()),b.fe(b.ftr(b.db.table(3).fetch(),function(a){return b.i64.eq(a.syncDatabaseId,c[22])}),function(a){var b=a.update;a.item;return b({lastSyncRequestTimestampMs:c[29]})})},function(a){return c[30]=c[0].get("group_id"),c[0],c[31]=b.i64.of_float(Date.now()),c[32]=b.i64.random(),c[45]=b.i64.and_(b.i64.or_(b.i64.lsl_(c[31],b.i64.to_int32(b.i64.cast([0,22]))),b.i64.and_(c[32],b.i64.cast([0,4194303]))),b.i64.cast([2147483647,4294967295])),b.db.table(3).fetch([[["",c[30]]]]).next().then(function(a,d){d=a.done;a=a.value;return d?b.db.table(3).add({syncDatabaseId:c[30],taskQueueName:"",failureCount:b.i64.cast([0,0]),lastSentTimestampMs:b.i64.cast([0,0]),lastSyncRequestTimestampMs:b.i64.cast([0,0]),epochId:c[45]}):(a.item,b.fe(b.db.table(3).fetch([[["",c[30]]]]),function(a){var b=a.update;a.item;return b({epochId:c[45]})}))})},function(a){return c[34]=c[0].get("group_id"),c[0],b.db.table(3).fetch([[["",c[34]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[35]=b.i64.cast([0,0]):(d=a.item,c[35]=d.failureCount)})},function(a){return c[37]=c[0].get("send_sync_params"),c[0],c[38]=c[0].get("sync_params"),c[0],c[39]=c[0].get("current_cursor"),c[0],c[40]=new b.Map(),c[40].set("database",c[34]),c[40].set("version",b.i64.cast([-1,4294967295])),c[40].set("epoch_id",c[45]),c[40].set("last_applied_cursor",c[39]),c[40].set("sync_params",c[37]?c[38]:e),c[40].set("failure_count",b.i64.gt(c[35],b.i64.cast([0,0]))?c[35]:e),c[41]=c[0].get("current_cursor"),c[0],e===c[41]?c[42]=b.i64.cast([0,1]):c[42]=b.i64.cast([0,2]),c[43]=new b.Map(),c[43].set("type",c[42]),c[43].set("request_payload",c[40]),c[44]=c[0].get("sync_channel"),c[0],a=[c[30],e,b.i64.cast([0,1]),c[43],b.i64.eq(c[44],b.i64.cast([0,2]))],c[23]=a[0],c[24]=a[1],c[25]=a[2],c[26]=a[3],c[27]=a[4],a}])},function(a){return a=[c[23],c[24],c[25],c[26],c[27]],c[12]=a[0],c[13]=a[1],c[14]=a[2],c[15]=a[3],c[16]=a[4],a}])},function(a){return a=[c[12],c[13],c[14],c[15],c[16]],c[3]=a[0],c[4]=a[1],c[5]=a[2],c[6]=a[3],c[7]=a[4],a}])},function(a){return c[8]=new b.Map(),c[8].set("sync_group_id",c[3]),c[8].set("next_sync_ms",c[4]),c[8].set("work_item_type",c[5]),c[8].set("network_payload",c[6]),c[8].set("skip_realtime_gateway",c[7]),d[0]=c[8]}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSBeginHandlingSync",["LSBeginHandlingSyncForSyncGroup"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(f){return c.seq([function(e){return d[0]=c.createArray(),c.fe(c.db.table(1).fetch(),function(e){var f=e.item;return c.seq([function(e){return c.sp(b("LSBeginHandlingSyncForSyncGroup"),f.groupId,a[0]).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[2]=(d[0].push(d[1]),d[0])}])})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSHandleTaskSendFailureForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(d){return b.seq([function(d){return b.islc(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(a,d){var f=a.done;a=a.value;return f?0:(d=a.item,b.db.table(2).fetch([[[d.taskId]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?0:(f=d.item,b.i64.neq(e,e)?(c[2]=b.i64.of_float(Date.now()),c[1]=b.i64.add(c[2],e)):c[1]=f.minTimeToSyncTimestampMs,b.fe(b.db.table(2).fetch([[[f.taskId]]]),function(a){var d=a.update;a.item;return d({failureCount:b.i64.add(f.failureCount,b.i64.cast([0,1])),minTimeToSyncTimestampMs:c[1]})}))}))})},function(c){return b.fe(b.db.table(3).fetch([[[a[0],b.i64.cast([-1,4294967295])]]]),function(a){var c=a.update;a=a.item;return c({failureCount:b.i64.add(a.failureCount,b.i64.cast([0,1]))})})},function(c){return b.fe(b.db.table(3).fetch([[[a[0],b.i64.cast([-1,4294967295])]]]),function(a){var b=a.update;a.item;return b({epochId:e,networkTaskIdentifier:e})})}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSHandleTaskSendSuccessForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return b.fe(b.ftr(b.db.table(3).fetch([[[a[0],b.i64.cast([-1,4294967295])]]]),function(c){return c.taskQueueName===a[0]&&b.i64.eq(c.syncDatabaseId,b.i64.cast([-1,4294967295]))&&!b.i64.eq(c.epochId,d)}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSPlatformDataTraceCheckPoint",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("I64")).of_int32(5e4);g.CLIENT_SEND_TASK_PAYLOAD=a}),98);
__d("LSPlatformRequestId",[],(function(a,b,c,d,e,f){"use strict";var g=4;function a(){var a=g;g+=1;return a}b={generate:a};f["default"]=b}),66);
__d("LSPlatformRequestScheduler",["clearTimeout","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.requests=new Map()}var b=a.prototype;b.schedule=function(a,b,d){var e=this.requests.get(b);e!=null&&c("clearTimeout")(e);this.requests.set(b,c("setTimeout")(a,d))};b.cleanup=function(){this.requests.forEach(function(a){return c("clearTimeout")(a)})};return a}();g["default"]=a}),98);
__d("LSPlatformServerResponseHandler",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(a){this.eval=a,this.currentlyRunning=(g||(g=b("Promise"))).resolve()}var c=a.prototype;c.evalWhenReady=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a,yield this.eval(b)});function c(b,c){return a.apply(this,arguments)}return c}();c.evalInOrderReceived=function(a,b){var c=this,d=this.currentlyRunning.then(function(){return c.evalWhenReady(a,babelHelpers["extends"]({},b,{priority:"sync_script"}))});this.currentlyRunning=d;return d};return a}();f["default"]=a}),66);
__d("LSPlatformSyncSystem",["FBLogger","I64","LSBeginHandlingSync","LSBeginHandlingSyncForSyncGroup","LSFactory","LSIntEnum","LSJson","LSPlatformGraphQLTransport","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSShape","LSVec","MWPBumpEntityKey","MessengerLogHistory","Promise","ReQL","asyncToGeneratorRuntime","gkx","promiseDone","recoverableViolation","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e,f,g,k,l){var m=d("MessengerLogHistory").getInstance("client_sync"),n=new(c("LSPlatformServerResponseHandler"))(f),o=function(c){return a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("network_requests")).getKeyRange("",c)));if(e!=null)return a.table("network_requests").put({epochId:void 0,failureCount:(j||(j=d("I64"))).add(e.failureCount,j.one),lastDelayedRequestTimestampMs:e.lastDelayedRequestTimestampMs,lastSentTimestampMs:e.lastSentTimestampMs,lastSyncRequestTimestampMs:e.lastSyncRequestTimestampMs,networkTaskIdentifier:e.networkTaskIdentifier,syncDatabaseId:e.syncDatabaseId,taskQueueName:e.taskQueueName});else return(h||(h=b("Promise"))).resolve()});return function(b){return a.apply(this,arguments)}}(),"readwrite")},p=new(c("LSPlatformRequestScheduler"))(),q=function(){var m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(m,o){o=d("LSShape").toRecord(o);var p=d("LSShape").toRecord(o.request_payload);o=o.type;var q=c("LSPlatformRequestId").generate();p=d("LSJson").stringify(d("LSShape").ofRecord({database:p.database,epoch_id:p.epoch_id,failure_count:p.failure_count,last_applied_cursor:p.last_applied_cursor,sync_params:p.sync_params,version:(j||(j=d("I64"))).of_string(g)}));var r=(j||(j=d("I64"))).equal(m.sync_group_id,(i||(i=d("LSIntEnum"))).ofNumber(1))&&c("gkx")("7914")===!0;if(!r&&m.skip_realtime_gateway){r=(yield d("LSPlatformGraphQLTransport").publish(k,q,o,p,l));var s=r[0],t=r[1],u=r[2];r=r[3];u={experiments:u,syncScript:t,target:r};return c("gkx")("6543")?n.evalInOrderReceived(s,u):f(u)}else{t=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("sync_groups")).getKeyRange(m.sync_group_id)));r=t!=null?t.syncChannel:(i||(i=d("LSIntEnum"))).ofNumber(1);return e.publish({payload:p,queueName:void 0,requestId:q,syncChannel:r,type_:o}).then(function(){return(h||(h=b("Promise"))).resolve()})}});return function(a,b){return m.apply(this,arguments)}}(),r=function e(f){var g=function(b){return a.runInTransaction(function(a){return c("LSBeginHandlingSyncForSyncGroup")(b,!1,c("LSFactory")(a))},"readwrite").then(function(a){return e(a[0])})},k=function(a,b){p.schedule(function(){c("promiseDone")(g(a))},(j||(j=d("I64"))).to_string(a),j.to_float(b))},l=d("LSShape").toRecord(f);f=l.work_item_type;if((j||(j=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(1))||(j||(j=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(5))){var n=l.network_payload;if(n!=null)return q(l,n)["catch"](function(a){if(a.message===d("LSPlatformGraphQLTransport").ServerError)d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_graphql_error");else if(a.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout||a.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected)d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_timeout_or_disc"),m.debug("Publish timed out");else{d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_other_error");if(a instanceof Error)c("FBLogger")("messenger_web_product").catching(a).mustfix("Encountered an JS error while publishing a LS sync request");else{var b="";try{b=JSON.stringify(a)}catch(a){}c("FBLogger")("messenger_web_product").mustfix("Encountered an JS error while publishing a LS sync request %s",b)}}return o(l.sync_group_id).then(function(){return g(l.sync_group_id)})});else{c("recoverableViolation")("Expected networkpayload for sync request but didn't get any","messenger_web_product");return(h||(h=b("Promise"))).resolve()}}if(!(j||(j=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(3)))if((j||(j=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))||!(j||(j=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(2)))return(h||(h=b("Promise"))).resolve();else{c("recoverableViolation")("Native handling for sync group not implemented yet","messenger_web_product");return(h||(h=b("Promise"))).resolve()}n=l.next_sync_ms;if(n!=null){k(l.sync_group_id,n);return(h||(h=b("Promise"))).resolve()}else{c("recoverableViolation")("Expected delay for delayed sync request but didn't get any","messenger_web_product");return(h||(h=b("Promise"))).resolve()}},s=function(a){return(h||(h=b("Promise"))).all(c("LSVec").toArray(a[0]).map(function(a){return r(a)}))},t=function(){c("promiseDone")(a.runInTransaction(function(a){return c("LSBeginHandlingSync")(!1,c("LSFactory")(a))},"readwrite").then(s))},u=c("throttle")(t,500);t=function(){return d("ReQL").fromTableAscending(a.table("sync_groups")).subscribe(function(){return u()})};var v=function(){return e.subscribeToNonTaskResponses(function(a,b){var e=b.ex,g=b.payload;e={experiments:e,syncScript:g,target:b.target};c("promiseDone")(c("gkx")("6543")?n.evalInOrderReceived(a,e):f(e),function(){return u()},function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","handle_sync_response_failure");if(a instanceof Error)c("FBLogger")("messenger_web_product").catching(a).mustfix("JS error encountered handling response from MQTT (pdb=%s): %s",c("gkx")("6543"),a.message);else{var b="";try{b=JSON.stringify(a)}catch(a){}c("FBLogger")("messenger_web_product").mustfix("JS error encountered handling response from MQTT (pdb=%s): %s",c("gkx")("6543"),b)}})})},w=function(){return e.onReconnect(function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","resume_sync_reconnect"),m.debug("Sync System reconnecting"),c("promiseDone")(a.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var f;f=(yield (f=d("ReQL")).toArrayAsync(f.mergeJoin(f.fromTableAscending(a.table("sync_groups")),f.fromTableAscending(a.table("network_requests")).getKeyRange(""))));yield (h||(h=b("Promise"))).all(f.map(function(a){a=a[1];return e.table("network_requests").put({epochId:void 0,failureCount:a.failureCount,lastDelayedRequestTimestampMs:a.lastDelayedRequestTimestampMs,lastSentTimestampMs:a.lastSentTimestampMs,lastSyncRequestTimestampMs:a.lastSyncRequestTimestampMs,networkTaskIdentifier:a.networkTaskIdentifier,syncDatabaseId:a.syncDatabaseId,taskQueueName:a.taskQueueName})}));return c("LSBeginHandlingSync")(!1,c("LSFactory")(e))});return function(a){return e.apply(this,arguments)}}(),"readwrite").then(s))})},x=t(),y=v(),z=w();u();return{cleanup:function(){x(),z(),y()}}}g["default"]=a}),98);
__d("LSPlatformSyncSystemEager",["LSPlatformSyncSystem","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve(c("LSPlatformSyncSystem"))}g["default"]=a}),98);
__d("LSPlatformTaskSystemTransport",["CurrentMessengerUser","FBLogger","I64","JSScheduler","LSAppendDataTraceAddon","LSBeginHandlingPendingTasksForQueue","LSFactory","LSHandleTaskSendFailureForQueue","LSHandleTaskSendSuccessForQueue","LSJson","LSPlatformDataTraceCheckPoint","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSShape","LSVec","MWPBumpEntityKey","MWPlatformTaskUtils","Promise","ReQL","asyncToGeneratorRuntime","cr:6666","cr:6668","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=function(){function a(a,e,f,g){var h=this;this.key="ls";this.$16=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield h.$1.runInTransaction(function(d){return c("LSBeginHandlingPendingTasksForQueue")(a,b,c("LSFactory")(d))},"readwrite"));e=e[0];yield h.$15(d("LSShape").toRecord(e))});return function(b,c){return a.apply(this,arguments)}}();this.$1=a;this.$2=e;this.$3=f;this.$4=g;this.$5=new(c("LSPlatformRequestScheduler"))();this.$6=new(c("LSPlatformServerResponseHandler"))(f);this.$7=this.$8();this.$9()}var e=a.prototype;e.$10=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield this.$1.runInTransaction(function(b){return c("LSHandleTaskSendFailureForQueue")(a,c("LSFactory")(b))},"readwrite")});function d(b){return a.apply(this,arguments)}return d}();e.$11=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield this.$1.runInTransaction(function(b){return c("LSHandleTaskSendSuccessForQueue")(a,c("LSFactory")(b))},"readwrite","background")});function d(b){return a.apply(this,arguments)}return d}();e.$12=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=c("LSVec").toArray(a.tasks).slice(0).map(function(a){return d("LSShape").toRecord(a)});a=a[0];if(a==null)return;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(this.$1.table("pending_tasks")).getKeyRange(a.task_id)));if(c("gkx")("6551")&&a!=null&&a.dataTraceId!=null&&a.context==="46")try{var b=a.dataTraceId;c("promiseDone")(this.$1.runInTransaction(function(a){return c("LSAppendDataTraceAddon")(b,d("LSPlatformDataTraceCheckPoint").CLIENT_SEND_TASK_PAYLOAD,(i||(i=d("I64"))).of_int32(1),void 0,"pdb",c("LSFactory")(a))},"readwrite"),function(a){},function(a){c("FBLogger")("messenger_web_product").catching(a).warn("AppendTrace rejected in task system")})}catch(a){c("FBLogger")("messenger_web_product").catching(a).warn("Cannot append trace in task system")}return a==null?void 0:a.dataTraceId});function e(b){return a.apply(this,arguments)}return e}();e.$13=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=this;if(a.network_payload==null)return;var g=d("LSShape").toRecord(a.network_payload);(j||(j=d("JSScheduler"))).scheduleLoggingPriCallback(function(){return g&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(g.tasks))});var k=this.$4;try{yield (h||(h=b("Promise"))).all(c("LSVec").toArray(g.tasks).map(function(a){return d("LSShape").toRecord(a)}).map(function(b){var g=c("LSPlatformRequestId").generate();return f.$2.publish({payload:d("LSJson").stringify(d("LSShape").ofRecord({label:b.label,payload:b.payload,version:k})),queueName:a.queue_name,requestId:g,syncChannel:(i||(i=d("I64"))).of_int32(1),type_:i.of_int32(e)})}))}catch(a){}});function e(b,c){return a.apply(this,arguments)}return e}();e.$14=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(a.network_payload==null)return;var f=d("LSShape").toRecord(a.network_payload),g=(yield this.$12(f));(j||(j=d("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(f.tasks))});var h=c("LSPlatformRequestId").generate(),k;try{k=(yield this.$2.publish({payload:d("LSJson").stringify(d("LSShape").ofRecord(babelHelpers["extends"]({},f,{version_id:this.$4},g==null?{}:{data_trace_id:g}))),queueName:a.queue_name,requestId:h,syncChannel:(i||(i=d("I64"))).of_int32(1),type_:i.of_int32(e)}))}catch(b){b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected?(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_notconnected"),c("FBLogger")("messenger_web_product").warn("Publishing a task to the server not connected")):(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),c("FBLogger")("messenger_web_product").warn("Error while publishing a task for request: %s, error %s",e,JSON.stringify(b))),yield this.$10(a.queue_name)}if(k!=null&&k.type==="taskresponse")try{g=k.downloadTask;var l=k.payload;h={experiments:l.ex,syncScript:l.payload,target:l.target};c("gkx")("6543")?yield this.$6.evalWhenReady(g,h):yield this.$3(h);yield this.$11(a.queue_name);(j||(j=d("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSent(f.tasks,l.payload))})}catch(b){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure"),c("FBLogger")("messenger_web_product").catching(b).mustfix("Encountered an error while processing a task response via realtime transport"),yield this.$10(a.queue_name)}});function e(b,c){return a.apply(this,arguments)}return e}();e.decideWhatToDoWithTask=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.runInTransaction(function(a){return c("LSBeginHandlingPendingTasksForQueue")(b,!1,c("LSFactory")(a))},"readwrite","background"));a=a[0];c("promiseDone")(this.$15(d("LSShape").toRecord(a)))});function e(b,c){return a.apply(this,arguments)}return e}();e.$15=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=this.$5,f=this.$16;function g(a,b){e.schedule(function(){c("promiseDone")(f(a,!1))},a,b)}var h=(i||(i=d("I64"))).to_int32(a.work_item_type);if(b("cr:6666")&&[1,5,2].includes(h))try{var j=(yield b("cr:6666").handleTask(this.$1,a,d("CurrentMessengerUser").getAccountID()));if(j!==b("cr:6666").DeferToLS)return}catch(b){c("FBLogger")("messenger_web_product").catching(b).mustfix("Error handling work for queue: %s",a.queue_name)}switch(h){case 1:yield this.$14(a,3);break;case 5:yield this.$13(a,4);break;case 3:g(a.queue_name,(i||(i=d("I64"))).to_float(a.next_sync_ms));break;case 2:if(b("cr:6666")==null){c("FBLogger")("messenger_web_product").mustfix("Native tasks not supported so far see gk mpf_web_native_tasks");c("FBLogger")("igd_web_on_msgr").mustfix("Native tasks not supported so far see gk igd_mpf_web_native_tasks");break}break;case 4:break;default:c("FBLogger")("messenger_web_product").warn("Unknown Task type of %s",h)}});function e(b){return a.apply(this,arguments)}return e}();e.$8=function(){var a=this,e=this.$1;return this.$2.onReconnect(function(){c("promiseDone")(e.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("network_requests")).bounds({gte:d("ReQL").key("")}))),f=c("LSFactory")(a);yield (h||(h=b("Promise"))).all(e.map(function(a){a=a.taskQueueName;return c("LSHandleTaskSendFailureForQueue")(a,f)}))});return function(b){return a.apply(this,arguments)}}(),"readwrite")),a.$9()})};e.$9=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.decideWhatToDoWithTask(a.$1,b)})};e.cleanup=function(){this.$7()};return a}();g["default"]=a}),98);
__d("MWPlatformTaskSystem",["LSPlatformRequestScheduler","MWPlatformTaskUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var e=this;this.$1=a;this.$2=b;this.$3=new(c("LSPlatformRequestScheduler"))();this.$4=d("MWPlatformTaskUtils").checkQueuesWhenPendingTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b)});this.$5=d("MWPlatformTaskUtils").checkQueuesWhenPendingFireForgetTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b)});this.$7()}var e=a.prototype;e.$6=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){yield this.$2.decideWhatToDoWithTask(a,b,c)});function c(b,c,d){return a.apply(this,arguments)}return c}();e.$7=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.$6(a.$1,b)})};e.cleanup=function(){this.$4.forEach(function(a){return a()}),this.$5.forEach(function(a){return a()}),this.$2.cleanup()};return a}();g["default"]=a}),98);